<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.5.2">Jekyll</generator><link href="https://sdunbar.me/feed.xml" rel="self" type="application/atom+xml" /><link href="https://sdunbar.me/" rel="alternate" type="text/html" /><updated>2017-09-05T17:10:34+00:00</updated><id>https://sdunbar.me/</id><title type="html">Technobabble</title><subtitle>Sean's Blog'</subtitle><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><entry><title type="html">Square Foot Gardening, Week 13</title><link href="https://sdunbar.me/personal/sfg-week13/" rel="alternate" type="text/html" title="Square Foot Gardening, Week 13" /><published>2017-09-05T00:00:00+00:00</published><updated>2017-09-05T00:00:00+00:00</updated><id>https://sdunbar.me/personal/sfg-week13</id><content type="html" xml:base="https://sdunbar.me/personal/sfg-week13/">&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;Mini update, their is a single pumpkin growing and it’s growing very well. I don’t think any other fruit will be able to mature in time, so I’m going to prune off any other fruit.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/McQ746X.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/McQ746X.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/hF3EpMx.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/hF3EpMx.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Project" /><category term="Plant" /><category term="Gardening" /><summary type="html">Thirteenth Week of Square Foot Gardening</summary></entry><entry><title type="html">Square Foot Gardening, Week 11</title><link href="https://sdunbar.me/personal/sfg-week11/" rel="alternate" type="text/html" title="Square Foot Gardening, Week 11" /><published>2017-08-21T00:00:00+00:00</published><updated>2017-08-21T00:00:00+00:00</updated><id>https://sdunbar.me/personal/sfg-week11</id><content type="html" xml:base="https://sdunbar.me/personal/sfg-week11/">&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;Further updates. The butternut squash has still yet to flower so I took no pictures of it, it likely won’t in time for a good harvest.&lt;/p&gt;

&lt;p&gt;The pumpkins have started to bear fruit, however since taking this picture, the largest has been damaged and removed from the plant.
The pumpkin plant has also been pruned back, with some vines cut far back and some fruit removed. There are currently two fruit growing, I may 
allow two more to grow, depending on where they grow from.&lt;/p&gt;

&lt;p&gt;There was also some damage on the leaves, not by slugs this time but from earwigs, I was able to manually remove and exterminate some of them at night, but they will likely be back, so I will have to keep an eye on them.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/LPQy6tv.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/LPQy6tv.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/76B5xEj.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/76B5xEj.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/7buZdbE.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/7buZdbE.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/I7i682H.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/I7i682H.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;http://i.imgur.com/L2Peyi0.jpg&quot;&gt;&lt;img src=&quot;http://i.imgur.com/L2Peyi0.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Project" /><category term="Plant" /><category term="Gardening" /><summary type="html">Eleventh Week of Square Foot Gardening</summary></entry><entry><title type="html">Square Foot Gardening, Week 8</title><link href="https://sdunbar.me/personal/sfg-week8/" rel="alternate" type="text/html" title="Square Foot Gardening, Week 8" /><published>2017-07-30T00:00:00+00:00</published><updated>2017-07-30T00:00:00+00:00</updated><id>https://sdunbar.me/personal/sfg-week8</id><content type="html" xml:base="https://sdunbar.me/personal/sfg-week8/">&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;First update in months due to being out of the country doing training for work.
The butternut squash and pumpkin have grown dramatically since, but have yet to start growing fruit. The vines 
from the butternut squash will need to be trained onto the trellis over the next couple of weeks. For now I’ve 
removed one of the pumpkin plants (which I meant to do a month ago) and trimmed back the plants to the better
stalks.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/1.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/1.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/2.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/2.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/3.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/3.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/4.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/4.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/5.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/5.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/6.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/6.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/7.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/7.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week8/8.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week8/8.jpg&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Project" /><category term="Plant" /><category term="Gardening" /><summary type="html">Eight Week of Square Foot Gardening</summary></entry><entry><title type="html">Square Foot Gardening, Week 3</title><link href="https://sdunbar.me/personal/sfg-week3/" rel="alternate" type="text/html" title="Square Foot Gardening, Week 3" /><published>2017-06-26T00:00:00+00:00</published><updated>2017-06-26T00:00:00+00:00</updated><id>https://sdunbar.me/personal/sfg-week3</id><content type="html" xml:base="https://sdunbar.me/personal/sfg-week3/">&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;More progress this week, pumpkins have grown out even more, slugs seem to be present so I need to deal with them.
Had to trim the butternut squash again as it seemed to have mildew, which is my own fault for watering improperly. 
Some animal had gotten into the bed one night and destroyed the smallest butternut squash also.&lt;/p&gt;

&lt;p&gt;Although I’m only going to end up keeping the largest of the pumpkin plants, the smallest seems to be developing downy mildew,
 so I’ll have to monitor it over the next week.&lt;/p&gt;

&lt;p&gt;Largest strawberry is starting to turn red! There’s not many growing on either plant yet however.&lt;/p&gt;

&lt;p&gt;I plan to redo the entire SFG plan later in the year, replacing the herbs with a proper plant, instead choosing
to grow the herbs in a seperate container later.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week3/1.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week3/1.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Raised Bed&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week3/2.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week3/2.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Strawberries&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week3/3.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week3/3.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Pumpkin&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week3/4.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week3/4.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Butternut Squash&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week3/5.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week3/5.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Butternut Squash&lt;/figcaption&gt;
&lt;/figure&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Project" /><category term="Plant" /><category term="Gardening" /><summary type="html">Third Week of Square Foot Gardening</summary></entry><entry><title type="html">Square Foot Gardening, Week 2</title><link href="https://sdunbar.me/personal/sfg-week2/" rel="alternate" type="text/html" title="Square Foot Gardening, Week 2" /><published>2017-06-19T00:00:00+00:00</published><updated>2017-06-19T00:00:00+00:00</updated><id>https://sdunbar.me/personal/sfg-week2</id><content type="html" xml:base="https://sdunbar.me/personal/sfg-week2/">&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;Some progress this week, pumpkins have grown out more, largest buttnernut squash leaf had been damaged so was removed.
Smallest butternut squash is growing a third leaf, so I guess it’s growing just fine again after transplanting.&lt;/p&gt;

&lt;p&gt;Also moved some strawberries nearby on an old bird feeder, to get more sun than it was getting in the previous position.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week2/1.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week2/1.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Raised Bed&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week2/2.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week2/2.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Pumpkin&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week2/3.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week2/3.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Butternut Squash&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week2/4.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week2/4.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Smallest Butternut Squash Sprout&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week2/5.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week2/5.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Strawberries&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week2/6.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week2/6.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Closeup of Strawberries&lt;/figcaption&gt;
&lt;/figure&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Project" /><category term="Plant" /><category term="Gardening" /><summary type="html">Second Week of Square Foot Gardening</summary></entry><entry><title type="html">Square Foot Gardening, Week 1</title><link href="https://sdunbar.me/personal/sfg-week1/" rel="alternate" type="text/html" title="Square Foot Gardening, Week 1" /><published>2017-06-12T00:00:00+00:00</published><updated>2017-06-12T00:00:00+00:00</updated><id>https://sdunbar.me/personal/sfg-week1</id><content type="html" xml:base="https://sdunbar.me/personal/sfg-week1/">&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;I’ve always wanted to grow vegetables and fruit at home, so this summer I decided to start a raised bed,
where I’d be able to grow a number of plants without having to dig up the entire garden.&lt;/p&gt;

&lt;p&gt;I decided to follow the ideas of “Square Foot Gardening”. This was based around the concept of planter allotments
that would be 4 square foot; Square Foot Gardening is basing the layout of a planter around square foot sized cells.&lt;/p&gt;

&lt;h1 id=&quot;planning&quot;&gt;Planning&lt;/h1&gt;
&lt;p&gt;I decided to first plan out what plants I wanted to grow in the end. I came up with the following:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week1/plan.png&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week1/plan.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;SFG Plan&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;I then bought a Planter kit from &lt;a href=&quot;http://quickcrop.ie/&quot;&gt;Quickcrop&lt;/a&gt; and just enough soil to fill it. I settled
on the 6x4 foot planter with trellis, as I wanted to grow butternut squash and tomatoes and they need support to grow tall.&lt;/p&gt;

&lt;h1 id=&quot;current-progress&quot;&gt;Current Progress&lt;/h1&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/sfg/week1/week1.jpg&quot;&gt;&lt;img src=&quot;/assets/images/sfg/week1/week1.jpg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Week 1&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;As you can see above, the plants are only just moved out, having been sprouted indoors in the last few weeks.&lt;/p&gt;

&lt;h1 id=&quot;future-plans&quot;&gt;Future Plans&lt;/h1&gt;

&lt;p&gt;Closer to August, I will need to order some garlic sets, as they are overwintered. I also have ordered some cheap 
wooden dowels to better mark out the square foot cells and will reposition plants as needed, which is only possible
right now as the plants are still very small.&lt;/p&gt;

&lt;p&gt;I may infact be able to order the live plants I need from Quickcrop, but will need to check that it is not too late in the year,
which I fear it is.&lt;/p&gt;

&lt;p&gt;I also plan to replace the pumpkins with potates after this year, as the variety I have is Atlantic Giant and am only 
growing them for the novelty, instead of taste, like the butternut squash.&lt;/p&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Project" /><category term="Plant" /><category term="Gardening" /><summary type="html">First Week of Square Foot Gardening</summary></entry><entry><title type="html">Final Year Project - Preliminary Report</title><link href="https://sdunbar.me/college/final-year-project/" rel="alternate" type="text/html" title="Final Year Project - Preliminary Report" /><published>2017-06-06T00:00:00+00:00</published><updated>2017-06-06T00:00:00+00:00</updated><id>https://sdunbar.me/college/final-year-project</id><content type="html" xml:base="https://sdunbar.me/college/final-year-project/">&lt;h1 id=&quot;acknowledgements&quot;&gt;Acknowledgements&lt;/h1&gt;

&lt;p&gt;I would like to thank Frank Duignan primarily for providing the
assistance I needed with the electronics aspects of this project, mainly
the LDR usage. Without this help these areas would have been seriously
lacking. I also want to thank him for taking the time to meet with me
over the project and discuss various parts of it to make it the best I
could.&lt;/p&gt;

&lt;h1 id=&quot;abstract&quot;&gt;Abstract&lt;/h1&gt;

&lt;p&gt;This report attempts to develop a small, IoT-style system for measuring,
monitoring and managing a plant pot. This would be achieved by
identifying the requirements of the system and designing an
implementation. This involves comparing multiple options for each
individual component and discussing the reason behind making choices in
each case. Finally, the security aspect will be reviewed and the
viability of powering the system by solar panels will be determined.&lt;/p&gt;

&lt;p&gt;The project was ultimately successful despite some setbacks and
logistics issues. The system appropriately measures and reports data to
a time-series database. These entries are then transformed into a graph
viewable via a web interface.&lt;/p&gt;

&lt;p&gt;Further research and refinement could be made following this, such as
reducing cost and size, as well as constructing a weatherproof,
solar-powered enclosure for the entire system.&lt;/p&gt;

&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#acknowledgements&quot; id=&quot;markdown-toc-acknowledgements&quot;&gt;Acknowledgements&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#abstract&quot; id=&quot;markdown-toc-abstract&quot;&gt;Abstract&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#table-of-contents&quot; id=&quot;markdown-toc-table-of-contents&quot;&gt;Table of Contents&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot; id=&quot;markdown-toc-introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#objectives-and-approach&quot; id=&quot;markdown-toc-objectives-and-approach&quot;&gt;Objectives and Approach&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#identification-of-a-suitable-single-board-computer-sbc-and-development-environment&quot; id=&quot;markdown-toc-identification-of-a-suitable-single-board-computer-sbc-and-development-environment&quot;&gt;Identification of a suitable Single Board Computer (SBC) and development environment&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#identification-of-a-suitable-software-components&quot; id=&quot;markdown-toc-identification-of-a-suitable-software-components&quot;&gt;Identification of a suitable software components&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#select-source-and-interface-with-sensors&quot; id=&quot;markdown-toc-select-source-and-interface-with-sensors&quot;&gt;Select, source and interface with sensors&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#select-source-and-interface-with-pump-system&quot; id=&quot;markdown-toc-select-source-and-interface-with-pump-system&quot;&gt;Select, source and interface with pump system&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#develop-sbc-application-in-tandem-with-software-components&quot; id=&quot;markdown-toc-develop-sbc-application-in-tandem-with-software-components&quot;&gt;Develop SBC application in tandem with software components&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#investigate-security-aspects-of-chosen-software-solution&quot; id=&quot;markdown-toc-investigate-security-aspects-of-chosen-software-solution&quot;&gt;Investigate security aspects of chosen software solution&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#test-and-analyse-performance&quot; id=&quot;markdown-toc-test-and-analyse-performance&quot;&gt;Test and analyse performance&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#background-of-technologies-chosen&quot; id=&quot;markdown-toc-background-of-technologies-chosen&quot;&gt;Background of Technologies Chosen&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#hardware--interfacing&quot; id=&quot;markdown-toc-hardware--interfacing&quot;&gt;Hardware &amp;amp; Interfacing&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#esp8266nodemcu&quot; id=&quot;markdown-toc-esp8266nodemcu&quot;&gt;ESP8266/NodeMCU&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#comparison-with-other-technologies&quot; id=&quot;markdown-toc-comparison-with-other-technologies&quot;&gt;Comparison with other technologies&lt;/a&gt;                &lt;ul&gt;
                  &lt;li&gt;&lt;a href=&quot;#arduino-nano&quot; id=&quot;markdown-toc-arduino-nano&quot;&gt;Arduino Nano&lt;/a&gt;                    &lt;ul&gt;
                      &lt;li&gt;&lt;a href=&quot;#technical-specs&quot; id=&quot;markdown-toc-technical-specs&quot;&gt;Technical Specs&lt;/a&gt;&lt;/li&gt;
                    &lt;/ul&gt;
                  &lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#raspberry-pi-zero-w&quot; id=&quot;markdown-toc-raspberry-pi-zero-w&quot;&gt;Raspberry Pi Zero W&lt;/a&gt;                    &lt;ul&gt;
                      &lt;li&gt;&lt;a href=&quot;#technical-specs-1&quot; id=&quot;markdown-toc-technical-specs-1&quot;&gt;Technical Specs&lt;/a&gt;&lt;/li&gt;
                    &lt;/ul&gt;
                  &lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#wemos-d1-mini&quot; id=&quot;markdown-toc-wemos-d1-mini&quot;&gt;WeMos D1 mini&lt;/a&gt;                    &lt;ul&gt;
                      &lt;li&gt;&lt;a href=&quot;#technical-specs-2&quot; id=&quot;markdown-toc-technical-specs-2&quot;&gt;Technical Specs&lt;/a&gt;&lt;/li&gt;
                    &lt;/ul&gt;
                  &lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#i2c-moisture-sensor&quot; id=&quot;markdown-toc-i2c-moisture-sensor&quot;&gt;I&lt;sup&gt;2&lt;/sup&gt;C Moisture Sensor&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#comparison-with-other-technologies-1&quot; id=&quot;markdown-toc-comparison-with-other-technologies-1&quot;&gt;Comparison with other technologies&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#i2c-standard&quot; id=&quot;markdown-toc-i2c-standard&quot;&gt;I&lt;sup&gt;2&lt;/sup&gt;C Standard&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#pump&quot; id=&quot;markdown-toc-pump&quot;&gt;Pump&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#light-detection&quot; id=&quot;markdown-toc-light-detection&quot;&gt;Light Detection&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#data-storage&quot; id=&quot;markdown-toc-data-storage&quot;&gt;Data Storage&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#influxdb&quot; id=&quot;markdown-toc-influxdb&quot;&gt;InfluxDB&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#why-a-tsdb&quot; id=&quot;markdown-toc-why-a-tsdb&quot;&gt;Why a TSDB?&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#comparison&quot; id=&quot;markdown-toc-comparison&quot;&gt;Comparison&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#data-presentation&quot; id=&quot;markdown-toc-data-presentation&quot;&gt;Data Presentation&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#grafana&quot; id=&quot;markdown-toc-grafana&quot;&gt;Grafana&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#comparison-1&quot; id=&quot;markdown-toc-comparison-1&quot;&gt;Comparison&lt;/a&gt;                &lt;ul&gt;
                  &lt;li&gt;&lt;a href=&quot;#chronograf&quot; id=&quot;markdown-toc-chronograf&quot;&gt;Chronograf&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#kibana&quot; id=&quot;markdown-toc-kibana&quot;&gt;Kibana&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#custom-application&quot; id=&quot;markdown-toc-custom-application&quot;&gt;Custom Application&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#operating-system&quot; id=&quot;markdown-toc-operating-system&quot;&gt;Operating System&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#unraid&quot; id=&quot;markdown-toc-unraid&quot;&gt;UnRAID&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#comparison-2&quot; id=&quot;markdown-toc-comparison-2&quot;&gt;Comparison&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#docker&quot; id=&quot;markdown-toc-docker&quot;&gt;Docker&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#comparison-3&quot; id=&quot;markdown-toc-comparison-3&quot;&gt;Comparison&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#testing&quot; id=&quot;markdown-toc-testing&quot;&gt;Testing&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#influxdbgrafana&quot; id=&quot;markdown-toc-influxdbgrafana&quot;&gt;InfluxDB/Grafana&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#i2c-moisture-sensor-1&quot; id=&quot;markdown-toc-i2c-moisture-sensor-1&quot;&gt;I&lt;sup&gt;2&lt;/sup&gt;C Moisture Sensor&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#design&quot; id=&quot;markdown-toc-design&quot;&gt;Design&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#hardware-design&quot; id=&quot;markdown-toc-hardware-design&quot;&gt;Hardware Design&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#software-design&quot; id=&quot;markdown-toc-software-design&quot;&gt;Software Design&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#implementation&quot; id=&quot;markdown-toc-implementation&quot;&gt;Implementation&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#sending-data-to-influxdb&quot; id=&quot;markdown-toc-sending-data-to-influxdb&quot;&gt;Sending Data to InfluxDB&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#testing-time-spent-awake&quot; id=&quot;markdown-toc-testing-time-spent-awake&quot;&gt;Testing time spent awake&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#displaying-data-in-grafana&quot; id=&quot;markdown-toc-displaying-data-in-grafana&quot;&gt;Displaying data in Grafana&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#code-refinement&quot; id=&quot;markdown-toc-code-refinement&quot;&gt;Code Refinement&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pump-1&quot; id=&quot;markdown-toc-pump-1&quot;&gt;Pump&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#system-performance&quot; id=&quot;markdown-toc-system-performance&quot;&gt;System Performance&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#performance-criteria&quot; id=&quot;markdown-toc-performance-criteria&quot;&gt;Performance Criteria&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#evaluation-procedures&quot; id=&quot;markdown-toc-evaluation-procedures&quot;&gt;Evaluation Procedures&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#sensor-reliability&quot; id=&quot;markdown-toc-sensor-reliability&quot;&gt;Sensor Reliability&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#power-usage&quot; id=&quot;markdown-toc-power-usage&quot;&gt;Power Usage&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#test-results&quot; id=&quot;markdown-toc-test-results&quot;&gt;Test Results&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#sensor-reliability-1&quot; id=&quot;markdown-toc-sensor-reliability-1&quot;&gt;Sensor Reliability&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#power-usage-1&quot; id=&quot;markdown-toc-power-usage-1&quot;&gt;Power Usage&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#solar-power-viability&quot; id=&quot;markdown-toc-solar-power-viability&quot;&gt;Solar Power Viability&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#testing-methods&quot; id=&quot;markdown-toc-testing-methods&quot;&gt;Testing Methods&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#test-results-1&quot; id=&quot;markdown-toc-test-results-1&quot;&gt;Test Results&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#security&quot; id=&quot;markdown-toc-security&quot;&gt;Security&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#influxdb-1&quot; id=&quot;markdown-toc-influxdb-1&quot;&gt;InfluxDB&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#grafana-1&quot; id=&quot;markdown-toc-grafana-1&quot;&gt;Grafana&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#external-access&quot; id=&quot;markdown-toc-external-access&quot;&gt;External Access&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#letsencrypt&quot; id=&quot;markdown-toc-letsencrypt&quot;&gt;LetsEncrypt&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#nginx&quot; id=&quot;markdown-toc-nginx&quot;&gt;Nginx&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#implementation-1&quot; id=&quot;markdown-toc-implementation-1&quot;&gt;Implementation&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#discussion&quot; id=&quot;markdown-toc-discussion&quot;&gt;Discussion&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusions&quot; id=&quot;markdown-toc-conclusions&quot;&gt;Conclusions&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#future-alternatives&quot; id=&quot;markdown-toc-future-alternatives&quot;&gt;Future Alternatives&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#references&quot; id=&quot;markdown-toc-references&quot;&gt;References&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The objective of this report is to research, design and implement a
self-contained plant monitoring system, wherein the system monitors the
soil moisture level, temperature and light level. It then outputs these
statistics to a database, from which a graph is generated based on the
supplied values and displayed over the web. The system will also be
capable of self-watering, where a pump will be activated which will draw
water from a reservoir, this will be triggered by the reading from the
soil moisture sensor.&lt;/p&gt;

&lt;h1 id=&quot;objectives-and-approach&quot;&gt;Objectives and Approach&lt;/h1&gt;

&lt;p&gt;The objective of this project is to develop a sensor platform that will
report soil moisture, temperature and light level back to a central
server, which will display these statistics in a graph over a web
interface. This will involve determining what single board computer
(SBC) to use, along with sensors, communication methods, data storage
methods and methods for displaying the stored information. The SBC will
also be able to drive a solenoid for watering the plant.&lt;/p&gt;

&lt;p&gt;The key objectives that must be achieved are as follows:&lt;/p&gt;

&lt;h3 id=&quot;identification-of-a-suitable-single-board-computer-sbc-and-development-environment&quot;&gt;Identification of a suitable Single Board Computer (SBC) and development environment&lt;/h3&gt;

&lt;p&gt;This will involve determining which SBC to use and what development
environment to use from the choices available. This will involve
comparing features between a handful of SBCs, namely IO features and
price. Then, a development environment must be chosen. Depending on the
SBC there might only be one choice available, but for those with a
choice, the environment or language with most familiarity or least
issues will be chosen.&lt;/p&gt;

&lt;h3 id=&quot;identification-of-a-suitable-software-components&quot;&gt;Identification of a suitable software components&lt;/h3&gt;

&lt;p&gt;This will require that a server-side data storage mechanism is decided
on and implemented, this must be accessible by both the SBC and the
graphing web service. This will be chosen based on ease of setup, ease
of use and integration with graphing service. A graphing web service
must also be decided on and implemented, this will follow the same
criteria as the database for selection.&lt;/p&gt;

&lt;h3 id=&quot;select-source-and-interface-with-sensors&quot;&gt;Select, source and interface with sensors&lt;/h3&gt;

&lt;p&gt;This will involve finding sensors that are capable of interfacing with
the SBC and have their data pulled as necessary. The sensor or sensor
package must be capable of at least measuring temperature, light level
and soil moisture level. These will be chosen based on ease of use,
complexity of wiring (A simple all-in-one solution is more desirable)
and price.&lt;/p&gt;

&lt;h3 id=&quot;select-source-and-interface-with-pump-system&quot;&gt;Select, source and interface with pump system&lt;/h3&gt;

&lt;p&gt;This will require finding a suitable pump and method of controlling it.
The pump must be small, quiet and suitable for deployment in multiple
environments. The method for activating the pump will be chosen based on
suitability, reliability and price.&lt;/p&gt;

&lt;h3 id=&quot;develop-sbc-application-in-tandem-with-software-components&quot;&gt;Develop SBC application in tandem with software components&lt;/h3&gt;

&lt;p&gt;This will be the actual design of the software for the SBC as well as
the setup of the server-side components, the database and graphing web
service. The software will be designed to do the following:&lt;/p&gt;

&lt;p&gt;Wake up every minute&lt;/p&gt;

&lt;p&gt;Pull data from the sensors&lt;/p&gt;

&lt;p&gt;Send collected data to database&lt;/p&gt;

&lt;p&gt;Turn on pump for X seconds (goal is 100ml of water per activation)&lt;/p&gt;

&lt;p&gt;Return to sleep mode&lt;/p&gt;

&lt;p&gt;The graphing service will need to be set up with appropriate queries to
best represent the data.&lt;/p&gt;

&lt;h3 id=&quot;investigate-security-aspects-of-chosen-software-solution&quot;&gt;Investigate security aspects of chosen software solution&lt;/h3&gt;

&lt;p&gt;This will involve investigating some aspects of security with the
software, these will mainly focus on the database and graphing server
and the data in transit from the SBC. This step will involve setting up
hardening the server where possible, so that the SBC can still transmit
data to the server.&lt;/p&gt;

&lt;h3 id=&quot;test-and-analyse-performance&quot;&gt;Test and analyse performance&lt;/h3&gt;

&lt;p&gt;This will involve testing and analysing performance, along with
determining viability of solar power as an option. This will mean
testing all the sensors for both accuracy and precision and testing the
pump is operating within reasonable limits for both ml of water pumped
and power usage. The power usage of the system with and without the pump
will also be measured, to use for determining if solar power is a viable
option.&lt;/p&gt;

&lt;h1 id=&quot;background-of-technologies-chosen&quot;&gt;Background of Technologies Chosen&lt;/h1&gt;

&lt;p&gt;The first steps in this project were to determine suitable hardware and
software. The hardware implementation needed to be capable of several
things:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Connect to a network&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Read in sensor data&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Send this data to a database&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Activate a pump on a trigger condition&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Sleep or delay for a set time&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;hardware--interfacing&quot;&gt;Hardware &amp;amp; Interfacing&lt;/h2&gt;

&lt;h3 id=&quot;esp8266nodemcu&quot;&gt;ESP8266/NodeMCU&lt;/h3&gt;

&lt;p&gt;The ESP8266 is a miniscule, low-cost System on a Chip (SOC) with
integrated WiFi. It features an 802.11b/g/n capabilities and is directly
programmable, but can also interface with other SBCs such as an Arduino. [1]&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image3.jpeg&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image3.jpeg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 1, LoLin NodeMCU [2]&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The NodeMCU is a Microcontroller Platform which features an ESP8266 at
its core. It is designed to be an easily interfaceable development
platform for the ESP8266, providing easier access to GPIO, I2C, PWM and
One-Wire. [3] It is scriptable via Lua, but is also able to be used with
MicroPython [4] and the Arduino IDE [5].&lt;/p&gt;

&lt;h4 id=&quot;comparison-with-other-technologies&quot;&gt;Comparison with other technologies&lt;/h4&gt;

&lt;p&gt;There are 3 main competing choices with the NodeMCU for this project:
the Arduino Nano, Raspberry Pi Zero and the Wemos D1.&lt;/p&gt;

&lt;h5 id=&quot;arduino-nano&quot;&gt;Arduino Nano&lt;/h5&gt;

&lt;p&gt;The Arduino Nano is another popular small SBC that is popular among
hobbyists. Despite its price being lower than the NodeMCU, it was
ultimately not chosen due to its lack of WiFi which was crucial to this
project.&lt;/p&gt;

&lt;h6 id=&quot;technical-specs&quot;&gt;Technical Specs&lt;/h6&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Microcontroller&lt;/th&gt;
      &lt;th&gt;ATmega328&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Architecture&lt;/td&gt;
      &lt;td&gt;AVR&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Operating Voltage&lt;/td&gt;
      &lt;td&gt;5V&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Flash Memory&lt;/td&gt;
      &lt;td&gt;32KB, 2KB used by bootloader&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SRAM&lt;/td&gt;
      &lt;td&gt;2KB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Clock Speed&lt;/td&gt;
      &lt;td&gt;16MHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Analog I/O Pins&lt;/td&gt;
      &lt;td&gt;8&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;EEPROM&lt;/td&gt;
      &lt;td&gt;1KB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DC Current per I/O Pins&lt;/td&gt;
      &lt;td&gt;40mA&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Input Voltage&lt;/td&gt;
      &lt;td&gt;7-12V&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Digital I/O Pins&lt;/td&gt;
      &lt;td&gt;22&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PWM Output&lt;/td&gt;
      &lt;td&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Power Consumption&lt;/td&gt;
      &lt;td&gt;19mA&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PCB Size&lt;/td&gt;
      &lt;td&gt;18 x 45mm&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Weight&lt;/td&gt;
      &lt;td&gt;7g&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Product Code&lt;/td&gt;
      &lt;td&gt;A000005&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Figure 2, Arduino Nano Technical Specs [6]&lt;/p&gt;

&lt;h5 id=&quot;raspberry-pi-zero-w&quot;&gt;Raspberry Pi Zero W&lt;/h5&gt;

&lt;p&gt;The Raspberry Pi Zero is another popular SBV, being much more powerful
than any other SBC considered. Ultimately it was decided against due to
lack of availability, larger form factor and power usage.&lt;/p&gt;

&lt;h6 id=&quot;technical-specs-1&quot;&gt;Technical Specs&lt;/h6&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Dimensions&lt;/th&gt;
      &lt;th&gt;65mm x 30mm x 5mm&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;SoC&lt;/td&gt;
      &lt;td&gt;Broadcom BCM2835&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;CPU&lt;/td&gt;
      &lt;td&gt;ARM11 at 1GHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;RAM&lt;/td&gt;
      &lt;td&gt;512MB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Wireless&lt;/td&gt;
      &lt;td&gt;2.4GHz 802.11n WLAN&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Bluetooth&lt;/td&gt;
      &lt;td&gt;4.1 and LE&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Power&lt;/td&gt;
      &lt;td&gt;5V via micro USB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Video and Audio&lt;/td&gt;
      &lt;td&gt;Mini-HDMI&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Storage&lt;/td&gt;
      &lt;td&gt;MicroSD Card&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Output&lt;/td&gt;
      &lt;td&gt;Micro Usb&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;GPIO&lt;/td&gt;
      &lt;td&gt;40 pings&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Pins&lt;/td&gt;
      &lt;td&gt;Run mode, RCA Composite&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Figure 3, Raspberry Pi Zero W Technical Specs [7]&lt;/p&gt;

&lt;h5 id=&quot;wemos-d1-mini&quot;&gt;WeMos D1 mini&lt;/h5&gt;

&lt;p&gt;This SBC is also based on the ESP8266, just like the NodeMCU, and it is
also able to use the Arduino IDE and the NodeMCU’s Lua firmware. It is
cheaper than the NodeMCU and offers the pinouts needed to use the
sensors. However, it was not chosen as there was some more familiarity
with the NodeMCU, the NodeMCU appeared to be the more mature product,
and a NodeMCU was available on hand for testing before the WeMos D1 mini
would have been able to arrive from China. Had there been enough time to
have on delivered, or if there was no NodeMCU to test early into the
project, this SBC would have been chosen.&lt;/p&gt;

&lt;h6 id=&quot;technical-specs-2&quot;&gt;Technical Specs&lt;/h6&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Microcontroller&lt;/th&gt;
      &lt;th&gt;ESP-8266EX&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Operating Voltage&lt;/td&gt;
      &lt;td&gt;3.3V&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Flash&lt;/td&gt;
      &lt;td&gt;4MB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Clock Speed&lt;/td&gt;
      &lt;td&gt;80MHz/160MHz&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Analog I/O Pins&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PCB Size&lt;/td&gt;
      &lt;td&gt;34.2mm x 25.6mm&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Weight&lt;/td&gt;
      &lt;td&gt;10g&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Figure 4, WeMos D1 Mini specs [8]&lt;/p&gt;

&lt;h3 id=&quot;i2c-moisture-sensor&quot;&gt;I&lt;sup&gt;2&lt;/sup&gt;C Moisture Sensor&lt;/h3&gt;

&lt;p&gt;The chosen moisture sensor was the I&lt;sup&gt;2&lt;/sup&gt;C Soil Moisture Sensor
by Catnip Electronics. It is an open source hardware solution that
provides measurement of soil moisture level, light level and
temperature. It uses the I&lt;sup&gt;2&lt;/sup&gt;C protocol for communication. [9]&lt;/p&gt;

&lt;p&gt;The sensor is powered by 3.3v – 5v, it will be used at 3.3v to use as
little power as possible. It is measured at 7.8mA when measuring at
3.3v, compared to 14mA at 5v. [9]&lt;/p&gt;

&lt;p&gt;The moisture sensor and light sensor are “relative” readings, meaning
the info is not some absolute value and only makes sense in relation to
other measurements. This means a baseline must be found for the moisture
reading to activate the pump. The temperature sensor returns an absolute
value, meaning it returns a value that makes sense by itself. In this
case, it’s in tenths of a degree Celsius, where a reading of 123 equates
to 12.3°C [9].&lt;/p&gt;

&lt;p&gt;The version of the sensor used was the Rugged version, this came with
wires pre-soldered and the PCB itself coated in epoxy and rubber. This
was chosen so that the sensor could be exposed to weather and be used
outside with minimal issue.&lt;/p&gt;

&lt;h4 id=&quot;comparison-with-other-technologies-1&quot;&gt;Comparison with other technologies&lt;/h4&gt;

&lt;p&gt;The DHT11 sensor is a non-I&lt;sup&gt;2&lt;/sup&gt;C alternative to fill in the
temperature niche, with the added measurement of humidity. It uses its
own proprietary protocol for communication. It would then be possible to
use a cheap capacitive sensor such as the hundreds available on
AliExpress. An LDR can then be used to measure the light levels.&lt;/p&gt;

&lt;p&gt;The reason this approach was not taken was two-fold, first, the NodeMCU
only has one analogue input, which means using something like a
multiplexer to use the capacitive sensor and LDR at the same time. The
second reason was the I&lt;sup&gt;2&lt;/sup&gt;C Moisture Sensor gave the
opportunity to learn and work with the I&lt;sup&gt;2&lt;/sup&gt;C standard.&lt;/p&gt;

&lt;p&gt;This approach would have one huge advantage though, price. The sensor
stick itself is €22 for the rugged version, while the DHT11 can be
gotten for around $1, the capacitive sensor for less than $1 and the LDR
for less than $1 also.&lt;/p&gt;

&lt;h4 id=&quot;i2c-standard&quot;&gt;I&lt;sup&gt;2&lt;/sup&gt;C Standard&lt;/h4&gt;

&lt;p&gt;The I&lt;sup&gt;2&lt;/sup&gt;C standard provides a communication protocol for serial
communication between devices. It uses two pins for communication, SCL
and SDA. Communications start with a pre-amble and end with a
post-amble. An addressing scheme is used, 7-bits long. I&lt;sup&gt;2&lt;/sup&gt;C
uses a master and slave system, where the master system sets the clock
rate via SCL. Unlike SPI, I&lt;sup&gt;2&lt;/sup&gt;C can support multiple masters
interconnected to multiple slaves. [10]&lt;/p&gt;

&lt;p&gt;I&lt;sup&gt;2&lt;/sup&gt;C transmits one bit of data for each clock pulse. Each
command starts with what’s known as a START condition and ends with a
STOP. For each of these the clock must be high, it is the transition of
SDA from high to low that determines START and STOP. [10]&lt;/p&gt;

&lt;p&gt;Data is sent in 8-bit bursts, which must then be followed by an ACK bit.
A clock pulse must be generated for each bit. If the slave does not send
an ACK it means that transmission has ended or the device is not ready
for transmission, it is then up to the master to generate the STOP
condition or repeated START. [10]&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image4.gif&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image4.gif&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 5, I2C Data Transfer example [10]&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;When using 7-bit addresses, the method used is slightly different.
Communication starts with the START condition as usual, which is then
followed by the address bits, plus a R/W bit, finally followed by an ACK
bit. R/W bit is used to determine the direction of data, whether the
slave is being written to or read from. When communication is finished,
a STOP condition is generated as it is above.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image5.gif&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image5.gif&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 6, I2C Data Transfer with 7-bit addresses [10]&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;When writing, the slave acknowledges all bytes sent; when the master is
finished, it sends the STOP condition. When reading however, the master
acknowledges all data bytes read instead, but of course still sends the
STOP condition. If the Master needs to change from reading to writing,
such as writing a register address to a slave and reading from it, it
will send the repeated START condition instead of STOP and then start
communicating again. [10]&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image6.gif&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image6.gif&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 7, I2C Data Transfer with 7-bit addresses, Repeated START [10]&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&quot;pump&quot;&gt;Pump&lt;/h3&gt;

&lt;p&gt;Unfortunately, due to logistics issues, an appropriate pump was unable
to be sourced. The pump was intended to be a small submersible pump,
placed into a small water tank. This pump would then be activated when
necessary to water the plant once moisture goes below a predefined
threshold.&lt;/p&gt;

&lt;p&gt;As an alternative to this, to illustrate the effect of enabling a device
under a trigger condition, an LED was enabled in its place. This was
achieved with a simple design:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image7.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image7.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 8, LED Diagram&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&quot;light-detection&quot;&gt;Light Detection&lt;/h3&gt;

&lt;p&gt;During later testing, it was discovered the LDR on the sensor stick was
obscured by the waterproof coating. This meant that a change was needed
in design and a replacement had to be found. With the help of Frank
Duignan, a simple LDR + resistor setup was devised as follows:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image8.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image8.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 9, LDR Diagram&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;data-storage&quot;&gt;Data Storage&lt;/h2&gt;

&lt;h3 id=&quot;influxdb&quot;&gt;InfluxDB&lt;/h3&gt;

&lt;p&gt;InfluxDB is a Time-Series Database (TSDB) with a query language like
Structured Query Language (SQL). As a TSDB, it is designed for storing
metrics and events from sensors and other data sources. [11]&lt;/p&gt;

&lt;p&gt;It features a simple HTTP API for access, which is written to and
queried with GET requests. Data is stored in a chosen Database using
several key/value pairs, notably measurement, fields and tags.
Measurement is used as an identifier for the entry, describing the type
of data the entry contains. Fields are used to store data in identified
fields, e.g. storing temperature data in a field with the key
‘Temperature’. Tags are like fields, but are optional and indexed.
InfluxDB encourages use of these, as they are indexed and thus much
faster to query than fields. [12]&lt;/p&gt;

&lt;p&gt;Being a TSDB, all entries have a timestamp, if the timestamp value is
left out of the entry, the entry will use the servers local Unix Epoch
timestamp. [13]&lt;/p&gt;

&lt;h4 id=&quot;why-a-tsdb&quot;&gt;Why a TSDB?&lt;/h4&gt;

&lt;p&gt;A time series database was chosen for this project based on the intended
application. Typical Relational databases such as PostgreSQL or MySQL
store data in “tables”. These tables share some sort of relationship
between the values and are identified with a primary key. There was also
the choice of a NoSQL database such as Redis or MongoDB, which do not
store data in tables but as simple files.&lt;/p&gt;

&lt;p&gt;These types of databases work for most types of data, it would have been
possible to use them in this case, however TSDBs offer a few advantages
that are well suited to this project:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Built-in operations to transform or aggregate a series&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Customisable retention policies (for example, to discard any data
over 72 hours old)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Out-of-the-box compatibility with Grafana and similar presentation
software&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For these reasons and for the ability to learn a new technology that is
gaining rapid popularity [14], InfluxDB was chosen.&lt;/p&gt;

&lt;h4 id=&quot;comparison&quot;&gt;Comparison&lt;/h4&gt;

&lt;p&gt;There are a handful of other TSDBs that can be used with Grafana, such
as openTSDB.&lt;/p&gt;

&lt;p&gt;OpenTSDB, like InfluxDB, is a scalable, distributed Time-Series Database
with an HTTP API. [15] The main reason it was not chosen was due ease of use
of InfluxDB. OpenTSDB does not have something like InfluxDB’s UDP Line
protocol, which trivialises sending data from a device that may not have
perfect connectivity most of the time.&lt;/p&gt;

&lt;h2 id=&quot;data-presentation&quot;&gt;Data Presentation&lt;/h2&gt;

&lt;h3 id=&quot;grafana&quot;&gt;Grafana&lt;/h3&gt;

&lt;p&gt;Grafana is an open source tool for metric analytics and visualisation.
It interfaces with many “Data Sources”, such as InfluxDB, Graphite and
OpenTSDB. It uses a user-defined query to aggregate and display data
from the selected data sources. Grafana has support for “Organization”
groups, which group users by what dashboards and data they can access.
for the purposes of this project only one organization will be used. [16]&lt;/p&gt;

&lt;p&gt;Grafana is accessible via a web interface, by default on port 3000. Data
sources are defined through this interface and dashboards are created
for them. Each dashboard is constructed from several different panels,
organized into rows.&lt;/p&gt;

&lt;p&gt;Panels are usually Graphs, which graph one or more series of data using
a set query and timeframe, but can also be “Singlestat”, which displays
a single series of data into a single number, such as the minimum or
average, “Dashlist”, which allows for linking to other dashboards within
Grafana, “Table”, which displays a series in a table instead of a graph,
and “Text”, which simply displays entered text. [16]&lt;/p&gt;

&lt;h4 id=&quot;comparison-1&quot;&gt;Comparison&lt;/h4&gt;

&lt;p&gt;There are 3 alternative approaches to this aspect, Chronograf, Kibana
and a custom-built user application.&lt;/p&gt;

&lt;h5 id=&quot;chronograf&quot;&gt;Chronograf&lt;/h5&gt;

&lt;p&gt;Chronograf is another open source monitoring tool, very similar to
Grafana. This was created by InfluxData, the same people who created
InfluxDB. So why choose Grafana over Chronograf? Functionally and
visually they are very similar, along with the ability to set up
queries, so the reason is mainly documentation, while Chronograf is well
documented by InfluxData, Grafana has a vast amount of user
documentation.&lt;/p&gt;

&lt;p&gt;Another main reason is to distance the visualisation from the data
storage backend. Chronograf is designed to be more tightly integrated
around InfluxDB and the “TICK” stack (Telegraf, InfluxDB, Chronograf,
Kapacitor).&lt;/p&gt;

&lt;h5 id=&quot;kibana&quot;&gt;Kibana&lt;/h5&gt;

&lt;p&gt;Kibana is part of the “ELK” software stack (ElasticSearch, LogStash,
Kibana). Again, it performs very similar functions to Grafana and
Chronograph, but is designed more for use in the ELK stack, like how
Chronograf is designed for use in the TICK stack. For the same reasons
as Chronograf, Kibana was decided against in favour of Grafana&lt;/p&gt;

&lt;h5 id=&quot;custom-application&quot;&gt;Custom Application&lt;/h5&gt;

&lt;p&gt;This would require developing a web frontend which takes in the queries
and transforms then into a graph. It was felt that this would be far too
difficult to implement given the level of skill required.&lt;/p&gt;

&lt;h2 id=&quot;operating-system&quot;&gt;Operating System&lt;/h2&gt;

&lt;h3 id=&quot;unraid&quot;&gt;UnRAID&lt;/h3&gt;

&lt;p&gt;UnRAID is a commercial Linux Distribution designed for servers. It is
intended to be used to create a software analogue to Redundant Array of
Independent Disks (RAID). It accomplishes this by using 1/2 Parity disks
to store information for any number of data disks. Data is not striped
or mirrored across drives, meaning read and write performance are
dependent on the drive being accessed at the time. [17]&lt;/p&gt;

&lt;p&gt;UnRAID also provides a simple WebGUI for creating and maintaining Docker
containers, which is how it will be used in this project. The reason for
this is that an UnRAID server was already available at the start of the
project and there was a lot of familiarity with it.&lt;/p&gt;

&lt;h4 id=&quot;comparison-2&quot;&gt;Comparison&lt;/h4&gt;

&lt;p&gt;Any operating system would be a suitable choice here, as InfluxDB and
Grafana run on Windows and Linux systems. The reason UnRAID was chosen
is because it was available, is familiar and offers an easy way to
deploy and maintain Docker containers.&lt;/p&gt;

&lt;h3 id=&quot;docker&quot;&gt;Docker&lt;/h3&gt;

&lt;p&gt;Docker provides a way to deploy applications independent of the
Operating System or hardware beneath it. It approaches this by using
“containers”, pre-made images containing the code/application, runtime,
system tools, libraries and settings. These containers are sandboxed
when deployed and OS agnostic, allowing for the same container image to
be used on any OS if it runs the Docker service. [18]&lt;/p&gt;

&lt;p&gt;Docker containers are not the same as Virtual Machines, as they do not
contain an entire operating system, however, Docker can be used on a
Virtual Machine.&lt;/p&gt;

&lt;h4 id=&quot;comparison-3&quot;&gt;Comparison&lt;/h4&gt;

&lt;p&gt;The primary alternative to using Docker containers is to install these
applications directly to the base operating system. This was decided
against for several reasons, foremost the simplicity of installation.
Docker Containers are also easier to migrate, as one can back up the
configuration data (stored all in one folder) and move it painlessly to
another install of the same container image.&lt;/p&gt;

&lt;h1 id=&quot;testing&quot;&gt;Testing&lt;/h1&gt;

&lt;h2 id=&quot;influxdbgrafana&quot;&gt;InfluxDB/Grafana&lt;/h2&gt;

&lt;p&gt;An InfluxDB Docker container and a Grafana Docker container were set up
on a home server. These Docker containers were installed on an UnRAID
server as follows:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image9.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image9.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 10, InfluxDB Container Creation&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;This creates a Docker container using the official InfluxDB image, with
the ports 8083 and 8086 being bound to it. 8083 is intended to provide a
Web GUI to the database, but is deprecated as of 1.1 and disabled by
default [19], 8086 is the port used by other services for querying or
writing to the database. By default, it is unsecured any anyone can
access it.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image10.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image10.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 11, Grafana Container Creation&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Grafana is set up through the same interface, it uses the official
Grafana image and is bound to port 3000, which provides the graphing
service aspect of this project. It has 2 keys passed into it, one is the
IP address or domain name of the server installed on and the other is
the default admin password. For the purposes of testing this was left at
default, but will be explored further in the security testing part of
this report.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image11.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image11.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 12, Grafana Data Source Creation Creation&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Once Grafana
is installed and logged into, the first step is to add a data source, as
seen on the left. The Data Source is given a name, testing in this case,
and a type, InfluxDB in this case.&lt;/p&gt;

&lt;p&gt;The URL of the database is then given. Because this is a Docker
container, we cannot use localhost and must give the full IP Address of
the server.&lt;/p&gt;

&lt;p&gt;Finally, the database is selected, Grafana automatically fills in the
default user of root:root, but InfluxDB by default has no
authentication, so this is not used.&lt;/p&gt;

&lt;p&gt;A simple script was written in Python to send random data within set
ranges to the database every minute. This was intended to simulate the
SBC reading the sensors and sending data. The script uses the
InfluxDBClient class from the influxdb package. The method
InfluxDBClient.write_points() is used, as this allows writing to
multiple time series names [20].&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;time&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;influxdb&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InfluxDBClient&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InfluxDBClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'192.168.0.11'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8086&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'test'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create_database&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'test'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The modules time and random are imported for logging to console when
data is posted and for generating the data later. The IP address, port,
username, password and database name are passed in to the InfluxDBClient
object. create_database() is used to create the test database we are
storing this data in, if it does not exist.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;json_body&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;measurement&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Temperature&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;fields&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uniform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;10.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;25.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;measurement&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Moisture&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;fields&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randrange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write_points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;json_body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Posted at &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strftime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Y-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;m-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;H:&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;M:&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;S&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;\\
&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gmtime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Inside a never-ending loop, we create a list of dictionaries,
representing JSON. Inside this list, we store two dicts, both with the
keys ‘measurement’ and ‘fields’. Measurement is used to identify what
this data represents, while fields contains another dict, representing
what fields the data has. In this case, only value is used, but time can
also be set here. If not set here, the server will use local time for
the data point.&lt;/p&gt;

&lt;p&gt;With the data successfully stored in the “test” database, a new
dashboard is created in Grafana connected to this. Two graphs are then
created to display the data. They use the following queries&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image12.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image12.png&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;This results in the query:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SELECT mean(&quot;value&quot;) FROM &quot;Moisture&quot; WHERE $timeFilter GROUP BY time(5m) fill(0)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This query plots the mean value of the last 5 minutes’ worth of Moisture
data. Fill(0) means it will start the graph at the value 0 instead of
auto-fitting the graph to the data.&lt;/p&gt;

&lt;p&gt;This results in the following graph after 1 hour of data has been
received:&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image13.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image13.png&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;p&gt;To illustrate the effect of the time() grouping, this is the same data
with time(1m):&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image14.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image14.png&quot; /&gt;&lt;/a&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;i2c-moisture-sensor-1&quot;&gt;I&lt;sup&gt;2&lt;/sup&gt;C Moisture Sensor&lt;/h2&gt;

&lt;p&gt;The Sensor Stick was connected to the NodeMCU via a breadboard. Due to
the breadboards imperfections, the NodeMCU will not fit directly into
it. The 3.3v pin is connected to the VCC of the sensor stick and the
SDA/SCL pins are connected for I&lt;sup&gt;2&lt;/sup&gt;C to function.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image15.jpeg&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image15.jpeg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 13, Crude testing setup, not pictured: Plant Pot and NodeMCU.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The NodeMCU is then connected to the computer via USB. The example
script from the I2CSoilMoistureSensor library is uploaded to the NodeMCU
via the Arduino IDE.&lt;/p&gt;

&lt;p&gt;The example script, available from Apollon77 on the GitHub repository
for the I2CSoilMoistureSensor Library [21], sets up the Sensor and prints
out the address and firmware version to serial. After this, it enters a
loop, where it prints out the soil moisture capacitance, temperature and
light level. It then sleeps for a moment before repeating again. The
sleep command drastically lowers the power usage of the sensor.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image16.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image16.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 14, Example Output from Example Script&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;This is some example output when the sensor is placed in a plant pot,
using the example script from the I2CMoistureSensor Arduino library. As
can be seen, there is some slight variance with the capacitance reading.&lt;/p&gt;

&lt;p&gt;During testing, it was also found that the light sensor is obscured in
the rugged version, attempts were made to contact the manufacturer to
discover if this was a defective sensor or if it was in fact blocked.
There was no response, so an alternative implementation had to be found.&lt;/p&gt;

&lt;p&gt;It was decided to use a simple LDR combined with the single Analog pin
to measure light level, this was set up on the breadboard following the
design outlined in the previous section.&lt;/p&gt;

&lt;p&gt;A modification was then made to the test script, replacing the built-in
light sensor method with a simple analogue read:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;, Light Level: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Fortunately, this worked perfectly, although the range was restricted to
a 10-bit number (0 to 1023), this was more than adequate.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image17.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image17.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 15, Testing of LDR&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;It was then necessary to test the deep sleep function of the NodeMCU.
This requires D0 to be wired to the RST pin first and foremost [22]. The
testing sketch is then appended as follows:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ESP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deepSleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SLEEP_DELAY_IN_SECONDS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WAKE_RF_DEFAULT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;SLEEP_DELAY_IN_SECONDS is a constant defined at the top of the
sketch, it is set to 5 so there is less waiting between tests. This Deep
Sleep function powers off everything but the RTC, which will generate a
short pulse out D0 when the time has run out. As this is connected to
the RST pin, it forces the device to reboot. This means that setup()
will be ran again each time the device starts up.&lt;/p&gt;

&lt;h1 id=&quot;design&quot;&gt;Design&lt;/h1&gt;

&lt;h2 id=&quot;hardware-design&quot;&gt;Hardware Design&lt;/h2&gt;

&lt;p&gt;The hardware will be connected via a simple breadboard. As it needs no
soldering, this allows for quick troubleshooting and amendments to be
made. All power will come from the 3v3 out pins on the NodeMCU. Pin D0
will also be wired to the RST pin, as this allows the ESP8266 to return
from Deep Sleep.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image18.jpeg&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image18.jpeg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 16, NodeMCU V1.0 pin definition [23]&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Using this pin definition, a drawing is created detailing the intended
layout of the final breadboard.&lt;/p&gt;

&lt;p&gt;To aid in the design of this project, the tool Fritzing was used. Using
this tool. it was possible to create the following breadboard layout.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image19.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image19.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 17, Breadboard Layout&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;This layout has the accompanying schematic as follows.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image20.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image20.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 18, Schematic Layout&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;As can be seen in the designs above, D1 will be connected to SCL, with
D2 connected to SDA. This allows I&lt;sup&gt;2&lt;/sup&gt;C to be used between the
NodeMCU and the Moisture Sensor.&lt;/p&gt;

&lt;p&gt;D8 is connected to the 270Ohm Resistor, which is then connected to the
LED. D8 is used as pins D5, D6, and D7 showed a “flicker” on the LED
when the NodeMCU was booting up.&lt;/p&gt;

&lt;p&gt;A0 is connected to the junction point between R2, a photocell LDR, and
R3, an 18kOhm resistor. This allows for a reading of the relative light
level.&lt;/p&gt;

&lt;p&gt;The Deep Sleep function is enabled by connecting D0 to RST. This is
needed, as Deep Sleep disables all but the Real-Time Clock and Deep
Sleep Watchdog Timer, which is loaded with the value entered in the
code. Once the DSWDT is ran down, an “interrupt” is generated, which
involves a single pulse out of D0. When wired up to RST, this enables
the NodeMCU to reset itself after entering deep sleep. This drastically
cuts down on power usage.&lt;/p&gt;

&lt;h2 id=&quot;software-design&quot;&gt;Software Design&lt;/h2&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image21.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image21.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 19, Basic Flowchart of Software&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The software will ultimately follow this simple flow, as the only
decision to make is whether the soil capacitance is low enough to
trigger the pump. The software will be implemented using the Arduino IDE
as it was the language with most familiarity.&lt;/p&gt;

&lt;h1 id=&quot;implementation&quot;&gt;Implementation&lt;/h1&gt;

&lt;h2 id=&quot;sending-data-to-influxdb&quot;&gt;Sending Data to InfluxDB&lt;/h2&gt;

&lt;p&gt;With the collection of data completed in the test sketch, it was time to
test sending it to InfluxDB. It was decided to use InfluxDB’s UDP Line
Protocol In a nutshell, this involves sending a datagram with the
content in the format of “[key] [fields] [timestamp]” [24]. To cut down
on complexity, the timestamp entry is omitted, as the server will append
its own timestamp if the query does not contain one.&lt;/p&gt;

&lt;p&gt;The connection to WiFi and using UDP to send the data requires the
following variables to be set up:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#define SLEEP_DELAY_IN_SECONDS 60&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ssid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Dunbar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;xxxxxx&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IPAddress&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;192&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;168&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;35&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IPAddress&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gateway&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;192&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;168&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IPAddress&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;subnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;192&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;168&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8089&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;WiFiUDP&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The connection is then started with the following two lines:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;WiFi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gateway&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;subnet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;WiFi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WIFI_STA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;WiFi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Connecting to &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ssid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;A while loop is used to delay until the connection is completed:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WiFi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WL_CONNECTED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Once this connection is complete, the following is printed to the Serial:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;WiFi connected&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IP address: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WiFi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;localIP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This concludes the Wi-Fi setup, so we then start the sensor with sensor.begin(); Inside loop(), we collect the data and send it off to the server:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sensor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isBusy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;send_moisture&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;send_temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;send_light&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sensor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;available&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;since&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FW&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.3&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ESP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deepSleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SLEEP_DELAY_IN_SECONDS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WAKE_RF_DEFAULT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;As written in the sensor testing sketch, this polls for the sensor to
not be busy, then runs 3 functions, each one collecting different data.
After this data is collected and sent, the sensor is set to sleep and
then the NodeMCU is set to deep sleep for the constant defined at the
top of the sketch.&lt;/p&gt;

&lt;p&gt;The content of the send_moisture() function is as follows:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sending Moisture Level&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;capacitance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;capacitance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sensor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getCapacitance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;moisture value=&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;capacitance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;send_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here, the sensor is polled for the capacitance reading, this is then
added to a String which follows the format outlined in the Line protocol
used by InfluxDB. The function send_line() is then called, which is as
follows:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sending datagram&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginPacket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endPacket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This begins the construction of a datagram, destined for the host and
port defined earlier. The line is then “printed” to the UDP object,
followed by the endPacket() function. A delay is then called to allow
for the datagram to be properly sent.&lt;/p&gt;

&lt;p&gt;Before this can all come together, some extra work is needed to be done
on the InfluxDB server. First, UDP must be enabled on a port (8089) and
a database must be defined, all Line entries are to the same database
defined in the config file:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[[udp]]
enabled = true
bind-address = &quot;:8089&quot;
database = &quot;plant&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With this enabled, the database must now be created, by entering CREATE
DATABASE plant in the InfluxDB web admin interface, which is also
enabled in the config. We can then verify the datagrams are being
received through the SHOW STATS query.&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image22.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image22.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 20, UDP stats from InfluxDB Web Interface&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;With the device running, diagnostic data is then printed to serial as
expected&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image23.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image23.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 21, Diagnostic info from device&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;testing-time-spent-awake&quot;&gt;Testing time spent awake&lt;/h2&gt;

&lt;p&gt;The rough time spent awake was recorded to determine power usage of the
device. With no static IP assigned, the WiFi took on average 825ms to
connect, this was then followed by a 250ms delay, along with three 100ms
delays, for a total of 1375ms. The IP was then hardcoded as shown in the
examples above, this drastically shortened the connection time down to
200ms, making a total of 750ms spent awake. It is possible to reduce
this further by redesigning the Line posting method, down to a single
packet.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;capacitance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temperature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;light&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;capacitance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sensor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getCapacitance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;moisture value=&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;capacitance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;temperature&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sensor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getTemperature&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;temperature value=&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;temperature&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;light&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;light value=&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;light&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sending datagram&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;beginPacket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;udp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endPacket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Replacing the three send functions with this shaves off another 200ms,
making the active time roughly 550ms. Posting every 60 seconds, this
means the device will be active only 0.91% of the time.&lt;/p&gt;

&lt;h2 id=&quot;displaying-data-in-grafana&quot;&gt;Displaying data in Grafana&lt;/h2&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image24.png&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image24.png&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 22, Final Grafana Dashboard&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;The following queries are used for these graphs:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SELECT median(&quot;value&quot;) FROM &quot;moisture&quot; WHERE $timeFilter GROUP BY time(5m) fill(0)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Light Level and Temperature of course do not use ‘FROM “moisture”’ and
instead use their respective data sets.&lt;/p&gt;

&lt;p&gt;What this query achieves is it extracts the median value of all the time
series entries in a 5 minute “slot” and outputs this to the graph.
Fill(0) is used to provide a constant floor of 0 for the graph. This
keeps the graph consistently scaled and easier to interpret.&lt;/p&gt;

&lt;h2 id=&quot;code-refinement&quot;&gt;Code Refinement&lt;/h2&gt;

&lt;p&gt;With a few days of testing, it was found that the delay() call after
deep sleep was entirely unnecessary, and did not in fact seem to be
doing anything.&lt;/p&gt;

&lt;p&gt;The delay after start sensor was also removed, in favour of the 50ms
delay loop already in place in loop(). This resulted in a further saving
of 250ms, as it was found that the loop was never entered after a test
of 100 restarts.&lt;/p&gt;

&lt;p&gt;During testing, it was discovered that on occasion the Sensor Stick
would not wake up properly from sleep, leading to erroneous readings
until the entire system was unplugged and reset. After doing some
research, an Issue was found out the GitHub for the
I2CSoilMoistureSensor library [25] detailing the same bug and discussing how
to fix it. However, since the sensor will be turned off anyway, making
the actual sleep call redundant, it was decided to remove the call to
the sensor to enter sleep entirely. After 168 hours’ runtime, the issue
did not present itself again.&lt;/p&gt;

&lt;h2 id=&quot;pump-1&quot;&gt;Pump&lt;/h2&gt;

&lt;p&gt;It was hoped that it would be possible to use a pump for this project,
but unfortunately due to logistics issues one was unable to be sourced
in time. In its place is a simple LED, as seen on the breadboard
schematic above. This is used in tandem with some code to emulate a pump
activation, simply blinking the LED on when the soil moisture reading is
low. The code for this is simple and is as follows:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sensor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getCapacitance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Low Moisture&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;High Moisture&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This basic code would write out to GPIO15 (which is D8 on the nodeMCU)
and set it high if the moisture was below a predetermined level, along
with printing this to the Serial output. If it was above this level, it
would set it low (redundant as it starts low) and print High Moisture to
the Serial output.&lt;/p&gt;

&lt;h1 id=&quot;system-performance&quot;&gt;System Performance&lt;/h1&gt;

&lt;p&gt;With the implementation now mostly complete, it was time to test the
systems performance.&lt;/p&gt;

&lt;h2 id=&quot;performance-criteria&quot;&gt;Performance Criteria&lt;/h2&gt;

&lt;p&gt;There are 2 major areas that will be tested, the reliability of the
sensors, which includes the precision and accuracy of the readings along
with how likely they are to fail.&lt;/p&gt;

&lt;p&gt;The second major area will be power usage, this will be used to
extrapolate the lifetime on a battery as well as potentially solar
powering the device.&lt;/p&gt;

&lt;h2 id=&quot;evaluation-procedures&quot;&gt;Evaluation Procedures&lt;/h2&gt;

&lt;h3 id=&quot;sensor-reliability&quot;&gt;Sensor Reliability&lt;/h3&gt;

&lt;p&gt;This meant testing the sensor for both failures and accuracy of the
readings. As the light and moisture readings are relative, it is only
possible to test them for failures, as the readings only make sense when
compared to other readings taken at different times.&lt;/p&gt;

&lt;p&gt;For the temperature, an IR spot sensor will be used to measure the
temperature on the stick and compare it to results posted by the sensor.&lt;/p&gt;

&lt;h3 id=&quot;power-usage&quot;&gt;Power Usage&lt;/h3&gt;

&lt;p&gt;This will involve determining the average power usage while active,
which can then be divided by the time spent awake vs asleep to roughly
determine power usage. This will be achieved by measuring with a USB
power tester, designed to test charging rates for phones, it will be
more than appropriate for this task.&lt;/p&gt;

&lt;h2 id=&quot;test-results&quot;&gt;Test Results&lt;/h2&gt;

&lt;h3 id=&quot;sensor-reliability-1&quot;&gt;Sensor Reliability&lt;/h3&gt;

&lt;p&gt;As mentioned above, the sensor proved to have some issues after a couple
days of testing, with false readings being read by the NodeMCU related
to putting the sensor to sleep(). This was resolved by simply removing
the call to sleep() entirely, as the sensor will be powered off when the
NodeMCU goes into DeepSleep anyway.&lt;/p&gt;

&lt;p&gt;It was also found that the moisture values would sometimes degrade
slower than expected, however, when the device is uprooted and replaced
or “jiggled” in place, lower values are often returned, it was found
this was somewhat dependent on the plant pot itself, poorly draining
pots seemed to retain patches of moisture instead of draining properly.
When placed in an appropriately sized pot for the plant with proper
drainage, the issue was less severe, resulting in a drop in the value
read of roughly 5-15, instead of the 50-60 or so seen with a poorly
draining pot.&lt;/p&gt;

&lt;p&gt;It was also found that distance from the base of the plant had an impact
on readings, with the areas closer to the plant base retaining moisture
for longer. In some cases, this was a difference in reading of 60.&lt;/p&gt;

&lt;h3 id=&quot;power-usage-1&quot;&gt;Power Usage&lt;/h3&gt;

&lt;p&gt;By connecting the NodeMCU to a bench power supply and an ammeter, it was
possible to determine the load during various states of operation.&lt;/p&gt;

&lt;p&gt;Under normal, idle conditions, such as when attempting to connect to
WiFi, the full system drew 80mA. This would spike to roughly 125mA when
polling the sensor. Under deep sleep, this dropped to a miniscule 10mA.&lt;/p&gt;

&lt;p&gt;Under normal conditions, the NodeMCU takes 200ms to connect, and a
further 100ms with the sensor enabled, this equates to 200ms using 80mA,
100ms using 125mA and 59.7 seconds using 10mA.&lt;/p&gt;

&lt;p&gt;This means that 99.5% of the time, the sensor will be using only 10mA,
0.33% using 80mA and 0.17% using 125mA. When averaged out, this means an
average power usage of 10.4mA. Conversely, if the delay after starting
the sensor was not removed, this results in an increase of 0.5mA once
averaged out.&lt;/p&gt;

&lt;p&gt;With a 2000mAh battery, assuming the battery can be used to its full
capacity with no loss, a runtime of 183 hours and 29 minutes is
calculated.&lt;/p&gt;

&lt;h2 id=&quot;solar-power-viability&quot;&gt;Solar Power Viability&lt;/h2&gt;

&lt;p&gt;In this section, the possibility of powering the system via a solar
panel and a LiPo battery will be assessed. The reasoning behind this is
to facilitate the system being placed in an outdoors environment, away
from where it would otherwise have easy access to power.&lt;/p&gt;

&lt;h3 id=&quot;testing-methods&quot;&gt;Testing Methods&lt;/h3&gt;

&lt;p&gt;Using the average power usage calculated above, a suitable battery will
be determined, along with a solar panel of appropriate power. The daily
generation of power will be calculated by assuming the solar panel will
output it’s full rating under sunshine hours and that the power usage
calculated above would be consistent.&lt;/p&gt;

&lt;p&gt;For testing purposes, a 6W 6V Solar Panel will be considered. A 3.7v
LiPo battery with a capacity of 2000mAh will also be considered for
testing. A component would be needed to both charge the battery from the
panel and power the system, such as the USB / DC / Solar Lithium
Ion/Polymer charger - v2 from AdaFruit.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;./media/image25.jpeg&quot; width=&quot;311&quot; height=&quot;234&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;span id=&quot;_Toc482919446&quot; class=&quot;anchor&quot;&gt;&lt;/span&gt;Figure 23, USB / DC /
Solar Lithium Ion/Polymer charger - v2&lt;/p&gt;

&lt;figure&gt;
	&lt;a href=&quot;/assets/images/final_year_report/image25.jpeg&quot;&gt;&lt;img src=&quot;/assets/images/final_year_report/image25.jpeg&quot; /&gt;&lt;/a&gt;
	&lt;figcaption&gt;Figure 23, USB / DC / Solar Lithium Ion/Polymer charger - v2 [26]&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&quot;test-results-1&quot;&gt;Test Results&lt;/h3&gt;

&lt;p&gt;According to the met office of Ireland, Ireland has between 5 – 6.5
hours of sunshine a day [27]. Using a 6W/6V panel, we will assume that it
will output at full power during this time. The solar panel outputs 1A,
meaning it should charge the 2000mAh cell fully in 2 hours of sunshine,
generating between 5000mAh and 6500mAh of charge per day. This is more
than adequate, considering the system will use around 250mAh per day.&lt;/p&gt;

&lt;p&gt;This offers a considerably safe choice for powering the system, under
normal conditions it is unlikely that it will output 100% power during
the 5 – 6.5 hours, but at anything above 5% power output, it outputs
more charge than the device will use.&lt;/p&gt;

&lt;h2 id=&quot;security&quot;&gt;Security&lt;/h2&gt;

&lt;p&gt;With testing complete, the security aspects of the project must be
discussed. This will involve determining potential weaknesses in the
NodeMCU, along with weaknesses with InfluxDB and Grafana.&lt;/p&gt;

&lt;h3 id=&quot;influxdb-1&quot;&gt;InfluxDB&lt;/h3&gt;

&lt;p&gt;InfluxDB can utilise a user-based permissions system, needing a username
and password to perform queries on the database. However, the UDP Line
posting protocol does not use this at all. This means that anyone or
anything can post to it without issues.&lt;/p&gt;

&lt;p&gt;The way to secure this would be to place the sensors on their own
subnet, with an ACL allowing only those sensors to post to the database.&lt;/p&gt;

&lt;h3 id=&quot;grafana-1&quot;&gt;Grafana&lt;/h3&gt;

&lt;p&gt;Grafana can also use a user-based permissions system, meaning accounts
can be set up purely for viewing data, with the admin account used only
for editing data. Grafana also has the option of allowing signups, but
this might want to be disabled depending on who the Grafana install is
intended to be shared with.&lt;/p&gt;

&lt;p&gt;Grafana also has an organisation system, which is a way of grouping
users with similar permissions, this is intended to restrict access to
certain dashboards for some groups and providing a way for them to
self-manage access within the group via Organisation Admins.&lt;/p&gt;

&lt;h3 id=&quot;external-access&quot;&gt;External Access&lt;/h3&gt;

&lt;p&gt;It is possible to use LetsEncrypt with Nginx to enable external access
to Grafana. Using the LetsEncrypt Docker, set up with a subdomain cert
for grafana.sdunbar.me, we can provide a HTTPS cert for the public
facing Grafana web interface.&lt;/p&gt;

&lt;h4 id=&quot;letsencrypt&quot;&gt;LetsEncrypt&lt;/h4&gt;

&lt;p&gt;LetsEncrypt is a free and automated open Certificate Authority, run by
the Internet Security Research Group. LetsEncrypt provides a free way to
create short-lived SSL/TLS certs for websites at no user cost. Any
number of certs can be created and renewed. Although no wildcard
certificates are available, any number of free subdomain-only certs can
be created, which alleviates the problem. [28]&lt;/p&gt;

&lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

&lt;p&gt;Nginx is a HTTP and reverse proxy server, with mail and TCP/UDP proxy
capabilities [29]. It gained huge popularity in Russia before gaining
popularity elsewhere and is now used by nearly one third of the
internet. [30]&lt;/p&gt;

&lt;h4 id=&quot;implementation-1&quot;&gt;Implementation&lt;/h4&gt;

&lt;p&gt;This requires creating a server{} block in the Nginx config file, which
is done as follows,&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server {
listen 443 ssl;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here a listening service is established on port 443, using SSL&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root /config/www;
index index.html index.htm index.php;
This defines the “root” folder of the webpage being served.
server_name grafana.*;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;This is one of the more important parts of the config, this means that
this specific block will only be run for any query with the URL
grafana.sdunbar.me. This allows for multiple services to be run on
independent subdomains.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssl_certificate /config/keys/letsencrypt/fullchain.pem;
ssl_certificate_key /config/keys/letsencrypt/privkey.pem;
ssl_dhparam /config/nginx/dhparams.pem;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This part defines the location of the cert, keys and Diffie-Hellman Key
Exchange parameter files.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssl_ciphers
ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';

ssl_prefer_server_ciphers on;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This massive block is quite simple, it is a list of ciphers that the
server will present as available to the client for establishing secure
communications&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;client_max_body_size 0;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Setting this parameter to 0 disables the checking of the “body” size of
requests, this would otherwise restrict the size of requests from the
client.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location / {
include /config/nginx/proxy.conf;
proxy_pass http://192.168.0.11:3030;
}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This concludes setting up what is known as a “reverse proxy” in Nginx.
This sets the location “/”, aka the root of the website being served, as
whatever data is located at &lt;a href=&quot;http://192.168.0.11:3030&quot;&gt;http://192.168.0.11:3030&lt;/a&gt;. In this example,
said URL and port points to the local Grafana install.&lt;/p&gt;

&lt;p&gt;This however only works if the user accesses
&lt;a href=&quot;https://grafana.sdunbar.me/&quot;&gt;https://grafana.sdunbar.me/&lt;/a&gt; and not http://, another block must be set
up for this to automatically redirect.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server {
listen 80;
server_name *.sdunbar.me;
return 301 https://$host$request_uri;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;With this block in place, any request to any subdomain on port 80 (HTTP)
will be redirected with error code 301 and towards the same address, but
with HTTPS instead of HTTP. Error code 301 indicates that the server has
Moved Permanently to the address returned along with it.&lt;/p&gt;

&lt;h2 id=&quot;discussion&quot;&gt;Discussion&lt;/h2&gt;

&lt;p&gt;With the tests complete, the sensor is working as well as can be
expected. The issue with false readings was resolved, meaning that the
sensor reports accurate results all the time now, so long as it is
repositioned regularly at spots with the same distance from the base of
the plant.&lt;/p&gt;

&lt;p&gt;It was also found that a Solar Panel for power was more than adequate,
with tests showing a cheap, 6W 6V panel providing more than 20 times as
much power as was needed to just about match the consumption of the
device. A 1W 6V panel coupled with a 1000mAh battery should be more than
adequate to power the system nearly indefinitely.&lt;/p&gt;

&lt;p&gt;When using appropriate user accounts for InfluxDB and Grafana, along
with combining them with proper subnetting, ACLs and LetsEncrypt for
external access, it was found to be more than adequate for security. It
is unfortunate that the UDP Line protocol is not encrypted at all,
however this is at least remediable on the network level by segmenting
the sensors off from the main network.&lt;/p&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;The intent of this project was to measure the soil moisture level,
temperature and light level of a plant pot, by using a small Single
Board Computer, and then sending these metrics to an appropriate
database with graphing, along with activating a pump if the plant pot
was too dry.&lt;/p&gt;

&lt;p&gt;After this was complete, the idea was to then determine power usage and
decide if solar power was a possible power source for this.&lt;/p&gt;

&lt;p&gt;Overall this project was successful in meeting these requirements, it is
unfortunate the pump was not able to be obtained as it would have been
interesting to see it in use and determine how long it needed to be ran
for to pump 100ml per activation.&lt;/p&gt;

&lt;h2 id=&quot;future-alternatives&quot;&gt;Future Alternatives&lt;/h2&gt;

&lt;p&gt;With the knowledge gained from completing this project, it would be very
easy to improve on this even further. Ways this could be improved would
be using a cheap radio transmitter instead of a board with WiFi,
hopefully cutting down on power usage even further. This could involve
having numerous sensors radio back metrics to a “base” station, which
would then upload the data to the database.&lt;/p&gt;

&lt;p&gt;A waterproof, solar-powered enclosure could be used in the system. This
would allow for easy deployment in a garden environment.&lt;/p&gt;

&lt;p&gt;It could also be used with a home irrigation system, using metrics about
the soil to activate a solenoid for a sprinkler, this would tie in well
with the Solar Panel idea and the radio transmitter idea, allowing for
multiple remote systems independently activating sprinklers in certain
areas of a garden.&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Ref No.&lt;/th&gt;
      &lt;th&gt;Reference&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;[1]&lt;/td&gt;
      &lt;td&gt;AdaFruit, “ESP8266 WiFi Module,” [Online]. Available: https://www.adafruit.com/product/2282. [Accessed 28 February 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[2]&lt;/td&gt;
      &lt;td&gt;BangGood, “LoLin V3 NodeMcu Lua WIFI Development Board,” [Online]. Available: http://www.banggood.com/V3-NodeMcu-Lua-WIFI-Development-Board-p-992733.html. [Accessed 23 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[3]&lt;/td&gt;
      &lt;td&gt;NodeMCU, “NodeMCU Features,” [Online]. Available: http://nodemcu.com/index_en.html#fr_54747361d775ef1a3600000f. [Accessed 28 February 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[4]&lt;/td&gt;
      &lt;td&gt;“Getting started with MicroPython on the ESP8266,” [Online]. Available: https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html. [Accessed 28 February 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[5]&lt;/td&gt;
      &lt;td&gt;B. Thomsen, “ESP8266 Getting Started with Arduino IDE,” [Online]. Available: https://bennthomsen.wordpress.com/iot/iot-things/esp8266-wifi-soc/esp8266-getting-started-with-arduino-ide/. [Accessed 28 February 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[6]&lt;/td&gt;
      &lt;td&gt;Arduino, “Arduino Nano,” [Online]. Available: https://www.arduino.cc/en/Main/ArduinoBoardNano. [Accessed 16 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[7]&lt;/td&gt;
      &lt;td&gt;The MagPI Magazine, “INTRODUCING RASPBERRY PI ZERO W,” [Online]. Available: https://www.raspberrypi.org/magpi/pi-zero-w/. [Accessed 16 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[8]&lt;/td&gt;
      &lt;td&gt;WeMos, “D1 mini,” [Online]. Available: https://www.wemos.cc/product/d1-mini.html. [Accessed 17 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[9]&lt;/td&gt;
      &lt;td&gt;Catnip Electronics, “I2C Soil moisture sensor,” 16 June 2015. [Online]. Available: https://www.tindie.com/products/miceuz/i2c-soil-moisture-sensor/. [Accessed 16 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[10]&lt;/td&gt;
      &lt;td&gt;i2c.info, “I2C Bus Specification,” [Online]. Available: http://i2c.info/i2c-bus-specification. [Accessed 13 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[11]&lt;/td&gt;
      &lt;td&gt;InfluxDB, “InfluxDB README.md,” 18 January 2017. [Online]. Available: https://github.com/influxdata/influxdb/blob/master/README.md. [Accessed 14 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[12]&lt;/td&gt;
      &lt;td&gt;InfluxDB, “InfluxDB Key Concepts,” [Online]. Available: https://docs.influxdata.com/influxdb/v1.2/concepts/key_concepts/#tag-key. [Accessed 14 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[13]&lt;/td&gt;
      &lt;td&gt;InfluxDB, “InfluxDB: Writing Data,” [Online]. Available: https://docs.influxdata.com/influxdb/v1.2/guides/writing_data/. [Accessed 14 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[14]&lt;/td&gt;
      &lt;td&gt;DB-Engines, “DB-Engines Ranking of Time Series DBMS,” DB-Engines, April 2017. [Online]. Available: https://db-engines.com/en/ranking/time+series+dbms. [Accessed 24 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[15]&lt;/td&gt;
      &lt;td&gt;OpenTSDB, “How does OPenTSDB work?,” [Online]. Available: http://opentsdb.net/overview.html. [Accessed 23 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[16]&lt;/td&gt;
      &lt;td&gt;Grafana, “Grafana: Basic Concepts,” 2017. [Online]. Available: http://docs.grafana.org/guides/basic_concepts/. [Accessed 18 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[17]&lt;/td&gt;
      &lt;td&gt;LimeTech, “Network-Attached Storage,” [Online]. Available: https://lime-technology.com/network-attached-storage/. [Accessed 20 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[18]&lt;/td&gt;
      &lt;td&gt;Docker, “What is a Container,” 2017. [Online]. Available: https://www.docker.com/what-container. [Accessed 4 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[19]&lt;/td&gt;
      &lt;td&gt;InfluxDB, “Web Admin Interface,” 12 March 2017. [Online]. Available: https://docs.influxdata.com/influxdb/v1.2/tools/web_admin/. [Accessed 12 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[20]&lt;/td&gt;
      &lt;td&gt;InfluxDB, “InfluxDB-Python,” 21 February 2017. [Online]. Available: https://github.com/influxdata/influxdb-python/blob/master/influxdb/client.py#L395. [Accessed 13 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[21]&lt;/td&gt;
      &lt;td&gt;Apollon77, “I2CSoilMoistureSensor,” 3 March 2017. [Online]. Available: https://github.com/Apollon77/I2CSoilMoistureSensor. [Accessed 27 March 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[22]&lt;/td&gt;
      &lt;td&gt;T. Foxworth, “MAKING THE ESP8266 LOW-POWERED WITH DEEP SLEEP,” 21 March 2017. [Online]. Available: https://www.losant.com/blog/making-the-esp8266-low-powered-with-deep-sleep. [Accessed 12 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[23]&lt;/td&gt;
      &lt;td&gt;A. Gerber, “Getting started with Espruino on ESP8266,” 2016. [Online]. Available: http://crufti.com/getting-started-with-espruino-on-esp8266/. [Accessed 27 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[24]&lt;/td&gt;
      &lt;td&gt;T. Persen, “How to send sensor data to InfluxDB from an Arduino Uno,” 29 September 2015. [Online]. Available: https://www.influxdata.com/how-to-send-sensor-data-to-influxdb-from-an-arduino-uno/. [Accessed 14 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[25]&lt;/td&gt;
      &lt;td&gt;simonrobb, “After calling sensor.sleep(), can’t read value #8,” 7 March 2017. [Online]. Available: https://github.com/Apollon77/I2CSoilMoistureSensor/issues/8. [Accessed 17 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[26]&lt;/td&gt;
      &lt;td&gt;Adafruit, “USB / DC / Solar Lithium Ion/Polymer charger - v2,” [Online]. Available: https://www.adafruit.com/product/390. [Accessed 4 May 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[27]&lt;/td&gt;
      &lt;td&gt;Met Eireann, “Sunshine and Solar Radiation,” [Online]. Available: http://www.met.ie/climate-ireland/sunshine.asp. [Accessed 4 May 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[28]&lt;/td&gt;
      &lt;td&gt;Let’s Encrypt, “About Let’s Encrypt,” 2017. [Online]. Available: https://letsencrypt.org/about/. [Accessed 26 April 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[29]&lt;/td&gt;
      &lt;td&gt;nginx, “nginx,” [Online]. Available: https://nginx.org/en/. [Accessed 18 May 2017].&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;[30]&lt;/td&gt;
      &lt;td&gt;Netcraft, “April 2017 Web Server Survey,” April 2017. [Online]. Available: https://news.netcraft.com/archives/2017/04/21/april-2017-web-server-survey.html. [Accessed 18 May 2017].&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Report" /><category term="Plant" /><summary type="html">This is the preliminary report I submitted for my Final Year Project in DT080B</summary></entry><entry><title type="html">Final Year Project - Preliminary Report</title><link href="https://sdunbar.me/college/final-year-project-prelim-report/" rel="alternate" type="text/html" title="Final Year Project - Preliminary Report" /><published>2017-02-18T00:00:00+00:00</published><updated>2017-02-18T00:00:00+00:00</updated><id>https://sdunbar.me/college/final-year-project-prelim-report</id><content type="html" xml:base="https://sdunbar.me/college/final-year-project-prelim-report/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The purpose of this Preliminary Report is to explain the objectives of the project and provide a timeline of events that need to be achieved. This will be done in the following manner:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Breaking down the project into a number of tasks&lt;/li&gt;
  &lt;li&gt;Describing these tasks&lt;/li&gt;
  &lt;li&gt;Researching existing solutions&lt;/li&gt;
  &lt;li&gt;Talking about research areas that will be covered&lt;/li&gt;
  &lt;li&gt;Creating a plan with times to complete each objective&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;objectives&quot;&gt;Objectives&lt;/h1&gt;

&lt;p&gt;The objective of this project is to develop a sensor platform that will report soil moisture, temperature and light level back to a central server, which will display these statistics in a graph over a web interface. This will involve determining what single board computer (SBC) to use, along with sensors, communication methods, data storage methods and methods for displaying the stored information. The SBC will also be able to drive a solenoid for the purpose of watering the plant.&lt;/p&gt;

&lt;p&gt;The key objectives that must be achieved are as follows:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Identification of a suitable SBC and development environment&lt;/li&gt;
  &lt;li&gt;Identification of a suitable web service&lt;/li&gt;
  &lt;li&gt;Select, source and interface with sensors&lt;/li&gt;
  &lt;li&gt;Select, source and interface with pump system&lt;/li&gt;
  &lt;li&gt;Develop SBC application in tandem with web service&lt;/li&gt;
  &lt;li&gt;Test and analyse performance.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;1 will involve determining which SBC to use, what development environment to use with it (e.g. some SBCs have different firmware which use different languages).&lt;/p&gt;

&lt;p&gt;2 will require that a server-side data storage mechanism is decided on and implemented, this must be accessible by both the SBC and the graphing web service. A graphing web service must also be decided on and implemented. Security will be a concern for all these web services and must be explored and commented on.&lt;/p&gt;

&lt;p&gt;3 will involve finding sensors that are capable interfacing with the SBC and have their data pulled as necessary.&lt;/p&gt;

&lt;p&gt;4 will require interfacing with a solenoid driver to activate a pump for watering the plant.  This will involve designing a circuit layout in the form of a breadboard prototype.&lt;/p&gt;

&lt;p&gt;5 will be the actual design of the software for the SBC as well as the setup of the server-side components, the database and graphing web service.&lt;/p&gt;

&lt;p&gt;Finally, part 6 will involve testing and analysing performance, along with determining viability of solar power as an option. This will mean testing all the sensors for both accuracy and precision and testing the pump is operating within reasonable limits for both ml of water pumped and power usage. The power usage of the system with and without the pump will also be measured, to use for determining if solar power is a viable option.&lt;/p&gt;

&lt;h1 id=&quot;ethics&quot;&gt;Ethics&lt;/h1&gt;

&lt;p&gt;Although the project itself has little ethical requirements due to its nature, I must still be ethical with regards to the report writing, making sure to reference all sources correctly and not claim credit for work that is not mine.&lt;/p&gt;

&lt;h1 id=&quot;research&quot;&gt;Research&lt;/h1&gt;

&lt;h2 id=&quot;existing-solutions&quot;&gt;Existing Solutions&lt;/h2&gt;

&lt;p&gt;A number of commercial plant monitors exist, one in particular being the Parrot Flower Power, by Parrot. This is a small unit, placed directly in the plants soil, which connects to a nearby phone via Bluetooth and reports on not only soil moisture level, temperature and light level but nutritional intake of the plant, powered with a 6 month battery. It also features a graph interface accessible via the app. [1]&lt;/p&gt;

&lt;p&gt;This however has rather poor reviews on sites such as CNET [2] and is now discontinued. The system I am planning to develop will have a number of advantages over this product:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Potentially Cheaper&lt;/li&gt;
  &lt;li&gt;Autonomous&lt;/li&gt;
  &lt;li&gt;Self-watering&lt;/li&gt;
  &lt;li&gt;No need for phone interaction&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;hardware&quot;&gt;Hardware&lt;/h2&gt;

&lt;p&gt;Many SBCs exist that are suitable for this project, such as the Arduino Uno/Nano and clones, the ESP8266 and derivatives, the Raspberry Pi and a ton of Chinese clones. This project will involve further research into these and comparing their suitability across several factors, such as cost, GPIO and power usage.&lt;/p&gt;

&lt;p&gt;The sensors used will be fairly standard, a soil moisture sensor, thermometer and light sensor. Many ultracheap sensors are available locally and from China. I will explore a number of available choices and compare them.&lt;/p&gt;

&lt;p&gt;The pump system will need to be suitable for the plant. This will involve a reservoir, pump, power source and a method of activating the pump, such as a solenoid. I will need to research the types of pumps available and compare how much power they use, how much space they take up and how reliable they are.&lt;/p&gt;

&lt;h2 id=&quot;software&quot;&gt;Software&lt;/h2&gt;

&lt;p&gt;Depending on the SBC chosen, there are a few software considerations to make. If choosing a full featured SBC such as the Pi, the entire software stack will be capable of running on it, however if something like an Arduino or ESP8266 is chosen, the data storage and graphing software must be installed on a server instead.&lt;/p&gt;

&lt;p&gt;I will also need to research a suitable database to store information from the device, along with suitable software for presenting this info in a graph. This will mean I must compare the many  database solutions available, talk about the advantages and disadvantages of each and talk about how they tie in with the graphing software.&lt;/p&gt;

&lt;h1 id=&quot;work-plan&quot;&gt;Work Plan&lt;/h1&gt;

&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Research Components of Project                                                -        2 weeks&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;Research Hardware                                                           -        1 week
        &lt;ol&gt;
          &lt;li&gt;Determine SBC to use&lt;/li&gt;
          &lt;li&gt;Determine Moisture Sensor&lt;/li&gt;
          &lt;li&gt;Determine LDR (or other optic sensor)&lt;/li&gt;
          &lt;li&gt;Determine Thermometer&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;Research Software                                                            -        1 week
        &lt;ol&gt;
          &lt;li&gt;Determine firmware to use on SBC&lt;/li&gt;
          &lt;li&gt;Determine Data Storage Solution to used&lt;/li&gt;
          &lt;li&gt;Determine Graphing Web Service to use&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Design Hardware Implementation                                                -        2 weeks&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;Set up SBC and interface with sensors                                        -        1 week
        &lt;ol&gt;
          &lt;li&gt;Set up each sensor individually and pull data from it&lt;/li&gt;
          &lt;li&gt;Test pushing of data from each sensor&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;Set up solenoid driver with SBC                                                -        1 week
        &lt;ol&gt;
          &lt;li&gt;Test activation of solenoid driver&lt;/li&gt;
          &lt;li&gt;Determine how long to run pump for desired output&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Design Software Implementation                                                -        2 weeks&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;Set up Data Storage Solution                                                -        1 week
        &lt;ol&gt;
          &lt;li&gt;Implement DSS in appropriate fashion taking security into account&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;Set up Graphing Web Service                                                -        1 week
        &lt;ol&gt;
          &lt;li&gt;Implement Graphing Web Service, track statistics and infer data from them&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Testing and Refinement                                                        -        2 weeks&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;Test values for accuracy                                                     -        1 week
        &lt;ol&gt;
          &lt;li&gt;Use known working thermometer to measure temperature&lt;/li&gt;
          &lt;li&gt;Test pump output matches expected values&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;Determine Solar Power viability                                        -        1 week
        &lt;ol&gt;
          &lt;li&gt;Measure power output and Sun                                        -        2 days
            &lt;ol&gt;
              &lt;li&gt;Compare power usage to potential photovoltaic panel power generation&lt;/li&gt;
              &lt;li&gt;Possibly use LDR to generate an estimate of power generation&lt;/li&gt;
            &lt;/ol&gt;
          &lt;/li&gt;
          &lt;li&gt;Research available solutions                                        -        3 days&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h1&gt;

&lt;p&gt;I believe with this preliminary report I have adequately outlined the steps I will need to take to fulfil this project in accordance with the guidelines set out by DIT. I have broken down the project into 6 steps, briefly talked about existing solutions and gave a timeline of events for the project.&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;[1]&lt;/th&gt;
      &lt;th&gt;Parrot, &quot;Parrot - Flower Power,&quot; 2017. [Online]. Available: &lt;a href=&quot;http://global.parrot.com/au/products/flower-power/&quot;&gt;http://global.parrot.com/au/products/flower-power/&lt;/a&gt;. [Accessed 16 February 2017].&lt;/th&gt;
      &lt;th&gt; &lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;[2]&lt;/td&gt;
      &lt;td&gt;A. Gebhart, &quot;Parrot Flower Power Review,&quot; 4 June 2014. [Online]. Available: &lt;a href=&quot;http://global.parrot.com/au/products/flower-power/&quot;&gt;https://www.cnet.com/uk/products/parrot-flower-power/review/&lt;/a&gt;. [Accessed 16 February 2017].&lt;/td&gt;
      &lt;td&gt;%&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Report" /><category term="Plant" /><summary type="html">This is the preliminary report I submitted for my Final Year Project in DT080B</summary></entry><entry><title type="html">Mobile Applications Formal Element</title><link href="https://sdunbar.me/mobile_applications/" rel="alternate" type="text/html" title="Mobile Applications Formal Element" /><published>2016-12-10T00:00:00+00:00</published><updated>2016-12-10T00:00:00+00:00</updated><id>https://sdunbar.me/mobile_applications</id><content type="html" xml:base="https://sdunbar.me/mobile_applications/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;The purpose of this formal element was to design an application for Android Devices that meets the following requirements:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The user will use the app to take a photo of the room&lt;/li&gt;
  &lt;li&gt;The user will then be able to superimpose a series of straight lines with double ended arrows onto the image&lt;/li&gt;
  &lt;li&gt;The lines will be drawn using finger touch&lt;/li&gt;
  &lt;li&gt;The user will also be able to add dimensions to each line&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In this report, I will outline how I have achieved this by describing the background design of the application, followed by a description of the code.&lt;/p&gt;

&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot; id=&quot;markdown-toc-introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#table-of-contents&quot; id=&quot;markdown-toc-table-of-contents&quot;&gt;Table of Contents&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#background&quot; id=&quot;markdown-toc-background&quot;&gt;Background&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#flow-of-the-application&quot; id=&quot;markdown-toc-flow-of-the-application&quot;&gt;Flow of the Application&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#overview&quot; id=&quot;markdown-toc-overview&quot;&gt;Overview&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#main-activity&quot; id=&quot;markdown-toc-main-activity&quot;&gt;Main Activity&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#xml&quot; id=&quot;markdown-toc-xml&quot;&gt;XML&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#imports&quot; id=&quot;markdown-toc-imports&quot;&gt;Imports&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#main-class&quot; id=&quot;markdown-toc-main-class&quot;&gt;Main Class&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#oncreate&quot; id=&quot;markdown-toc-oncreate&quot;&gt;OnCreate()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#request_permissions&quot; id=&quot;markdown-toc-request_permissions&quot;&gt;Request_permissions()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#onclick&quot; id=&quot;markdown-toc-onclick&quot;&gt;onClick()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#getoutputmediafile&quot; id=&quot;markdown-toc-getoutputmediafile&quot;&gt;getOutputMediaFile()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#onactivityresult&quot; id=&quot;markdown-toc-onactivityresult&quot;&gt;onActivityResult()&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#draw-lines-class&quot; id=&quot;markdown-toc-draw-lines-class&quot;&gt;Draw Lines class&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#xml-1&quot; id=&quot;markdown-toc-xml-1&quot;&gt;XML&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#main-class-1&quot; id=&quot;markdown-toc-main-class-1&quot;&gt;Main Class&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#oncreate-1&quot; id=&quot;markdown-toc-oncreate-1&quot;&gt;onCreate()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#getresizedbitmap&quot; id=&quot;markdown-toc-getresizedbitmap&quot;&gt;getResizedBitmap()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ontouch&quot; id=&quot;markdown-toc-ontouch&quot;&gt;onTouch()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#onclick-1&quot; id=&quot;markdown-toc-onclick-1&quot;&gt;onClick()&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#fillarrow&quot; id=&quot;markdown-toc-fillarrow&quot;&gt;fillArrow()&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot; id=&quot;markdown-toc-conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;

&lt;p&gt;The application will be designed in Android using Android Studio. This is an IDE maintained by Google specifically for the development of Android Apps.&lt;/p&gt;

&lt;p&gt;It will consist of two activities; an activity represents a &quot;screen&quot; in an Android application. Activities can be swapped between and pass messages between each other using intents. In this application, the main_activity activity will use an intent to take a picture of an image, it will pass in a URI object into this intent, which is where the photo will be saved. It will then start another activity with the URI passed to it, draw_lines. Once draw_lines is finished, the imageView will be updated with the new image with lines drawn on it.&lt;/p&gt;

&lt;p&gt;The main activity consists of a textView (an object in Android used to display text), a button (used to execute code on press) and an ImageView (used to display an image on screen). This activity will, on button press, start an intent for any application that can take photos, it will pass in the URI object (a location to store the photo at) as an extra; An intent is a way to start other activities in Android and pass data between them, an extra is how these messages are stored, accessed by using keys, which is a string used to identify the extra.&lt;/p&gt;

&lt;p&gt;This activity will then start another intent for draw_lines, it will pass in a URI again which contains a link to the image. Once draw_lines has passed back in the URI after it is finished drawing, main_activity will then display the new image with lines.&lt;/p&gt;

&lt;p&gt;The second activity, draw_lines, will display an image using an ImageView, which will then be drawable using a Canvas and Paint object. It will also feature an EditText field, for user-entered dimensions, and a button, for saving the image and exiting back to main_activity, returning the URI of the new image with it.&lt;/p&gt;

&lt;p&gt;The main_activity class will also implement the OnClickListener interface, this means it must implement the onClick(View v) method. This is used to determine when an element on the screen is clicked on by the user. For the main_activity we want this on the &quot;Launch Camera&quot; button. Inside onClick we then have an if statement checking if it was pressed. If it was, we execute the code inside.&lt;/p&gt;

&lt;p&gt;The draw_lines class implements the OnClickListener interfaces as well as the OnTouchListener, meaning it must implement onClick(View v) and onTouch(View v). onClick(View v) functions similarly to main_activity, in that is used to determine when a button is pressed. Then an  onTouch(View v) method is implemented. This is used to check when the user touches the screen and then removes his finger from the screen. In this class, we get the coordinates of when the user touches the screen, when he removes his finger we get the coordinates for that also. Then we draw the line between these two coordinates, draw the text from the EditText field in the middle of this line and finally add the arrowheads to it.&lt;/p&gt;

&lt;p&gt;The main_activity class will also request permissions, which is required for Android Marshmallow and above, it does this by calling a request_permissions() method, which uses Android's built in methods to determine if we have permission to save images or not. If we don't it will prompt the user to grant the app permissions.&lt;/p&gt;

&lt;p&gt;The layout will be constructed via XML, which is the language Android uses for displaying elements on the screen. Using this I will design the two layouts of the activities to be simple and understandable.&lt;/p&gt;

&lt;h1 id=&quot;flow-of-the-application&quot;&gt;Flow of the Application&lt;/h1&gt;
&lt;p&gt;Figure 1, flowchart of app&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/college/flow.png&quot; alt=&quot;flow&quot; class=&quot;img-responsive&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;overview&quot;&gt;Overview&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/college/app1.png&quot; alt=&quot;app1&quot; class=&quot;img-responsive align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The main activity is the screen viewable upon opening the app, 
it features an imageview, along with a button to launch the camera Intent.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/college/app2.png&quot; alt=&quot;app2&quot; class=&quot;img-responsive align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the photo is captured, the draw_lines class is started, with the image displayed in the imageview.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/college/app3.png&quot; alt=&quot;app3&quot; class=&quot;img-responsive align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The user is then able to input the dimensions in the field at the bottom, which will be applied to any line drawn.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/college/app4.png&quot; alt=&quot;app4&quot; class=&quot;img-responsive align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the user has hit the finished button, this image is then saved, 
the main_acitivity screen is brought up again with the new image displayed.&lt;/p&gt;

&lt;h1 id=&quot;main-activity&quot;&gt;Main Activity&lt;/h1&gt;

&lt;h2 id=&quot;xml&quot;&gt;XML&lt;/h2&gt;

&lt;p&gt;The code for this layout is as follows:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;RelativeLayout&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:android=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xmlns:tools=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.android.com/tools&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/activity_main&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:paddingBottom=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@dimen/activity_vertical_margin&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:paddingLeft=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@dimen/activity_horizontal_margin&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:paddingRight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@dimen/activity_horizontal_margin&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:paddingTop=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@dimen/activity_vertical_margin&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;tools:context=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;me.sdunbar.cameradistance.MainActivity&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;TextView&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;fill_parent&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@string/intro&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_margin=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;3dp&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:textStyle=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bold&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/textView&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Button&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/capture_btn&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@string/capture&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_below=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/textView&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignLeft=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/textView&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignStart=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/textView&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ImageView&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/picture&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:minHeight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;300dp&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:minWidth=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;300dp&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:contentDescription=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@string/picture&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:background=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@drawable/pic_border&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_below=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/capture_btn&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignLeft=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/capture_btn&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignStart=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/capture_btn&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:scaleType=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;fitXY&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/RelativeLayout&amp;gt;&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;imports&quot;&gt;Imports&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.Manifest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.content.pm.PackageManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.graphics.BitmapFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.os.Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.support.v4.app.ActivityCompat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.support.v4.content.ContextCompat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.support.v7.app.AppCompatActivity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.os.Bundle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.content.ActivityNotFoundException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.content.Intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.graphics.Bitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.net.Uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.provider.MediaStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.view.View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.view.View.OnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.widget.Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.widget.ImageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;android.widget.Toast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.io.File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.io.FileNotFoundException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.io.InputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.text.SimpleDateFormat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;These imports allow the use of various methods within the class.&lt;/p&gt;

&lt;h2 id=&quot;main-class&quot;&gt;Main Class&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AppCompatActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnClickListener&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This line defines the start of the block of code making up the class MainActivity, we also implement the OnClickListener interface to allow us to use the button.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CAMERA_CAPTURE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APP_REQUEST&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;69&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXTRA_MESSAGE&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;&quot;me.sdunbar.intenttest.myKey&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Bitmap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mImageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;These variable declarations are done at the top, to be able to use them throughout the class.&lt;/p&gt;

&lt;h3 id=&quot;oncreate&quot;&gt;OnCreate()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;//retrieve a reference to the UI button&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;captureBtn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;capture_btn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;//handle button clicks&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;captureBtn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;mImageView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;request_permissions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This instantiates the button and imageview, sets the onClickListener for the button, as well as starts the request_permissions() method, which is used to allow us to save to external storage.&lt;/p&gt;

&lt;h3 id=&quot;request_permissions&quot;&gt;Request_permissions()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;request_permissions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ContextCompat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;checkSelfPermission&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;Manifest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;permission&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;WRITE_EXTERNAL_STORAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PackageManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;PERMISSION_GRANTED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActivityCompat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;shouldShowRequestPermissionRationale&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;Manifest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;permission&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;WRITE_EXTERNAL_STORAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;ActivityCompat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;requestPermissions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Manifest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;permission&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;WRITE_EXTERNAL_STORAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;},&lt;/span&gt;
                        &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This block of code was available from Android's official documentation, it first checks if we have permissions to write to external storage, if not, it prompts the user for permission.&lt;/p&gt;

&lt;h3 id=&quot;onclick&quot;&gt;onClick()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;capture_btn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;c1&quot;&gt;//use standard intent to capture an image&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;captureIntent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MediaStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACTION_IMAGE_CAPTURE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fromFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getOutputMediaFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;captureIntent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;putExtra&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MediaStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;EXTRA_OUTPUT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

              &lt;span class=&quot;c1&quot;&gt;//we will handle the returned data in onActivityResult&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;startActivityForResult&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;captureIntent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CAMERA_CAPTURE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ActivityNotFoundException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anfe&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
              &lt;span class=&quot;c1&quot;&gt;//display an error message&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errorMessage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Whoops - your device doesn't support capturing images!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;Toast&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;toast&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Toast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;makeText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errorMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Toast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENGTH_SHORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;toast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is the onClick handler, if the capture button is pressed, we declare and instantiate an Intent called CaptureIntent, this will use ANY application on the phone that can respond to this request. We also pass in a URI, defined from getOutputMediaFile(), we add this as an extra into captureIntent so that the application will save the image at the URI given to it. We then start this intent with startActivityForResult and the request code CAMERA_CAPTURE.&lt;/p&gt;

&lt;p&gt;The error handling in the catch is for if no application can respond to the intent request. It will pop up a toast (sliding notification from the bottom of the screen) to alert the user that no camera app is available.&lt;/p&gt;

&lt;h3 id=&quot;getoutputmediafile&quot;&gt;getOutputMediaFile()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getOutputMediaFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getExternalStoragePublicDirectory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
               &lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DIRECTORY_PICTURES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;CameraDemo&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;


        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mkdirs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()){&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SimpleDateFormat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;yyyyMMdd_HHmmss&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;imageFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;separator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;imageFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;.png&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is used to determine where to store the saved file and what to call it, first we create a file by calling:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_getExternalStoragePublicDirectory_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_DIRECTORY&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_PICTURES_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This returns the location that Android has determined to be the public folder for storing pictures, the other variable &quot;CameraDemo&quot; allows us to create a folder called CameraDemo for storing our own images.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;exists&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mkdirs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()){&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This allows us to check if the folder exists and to attempt to create it if it does not.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SimpleDateFormat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;yyyyMMdd_HHmmss&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;imageFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;separator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;imageFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;.png&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This generates a timestamp of the current time and formats it. We then return a file object with the path, filename and the extension .png.&lt;/p&gt;

&lt;h3 id=&quot;onactivityresult&quot;&gt;onActivityResult()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requestCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resultCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resultCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RESULT_OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;c1&quot;&gt;//user is returning from capturing an image using the camera&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;requestCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CAMERA_CAPTURE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;

              &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image_stream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getContentResolver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BitmapFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;decodeStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image_stream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileNotFoundException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


              &lt;span class=&quot;c1&quot;&gt;//retrieve a reference to the ImageView&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;c1&quot;&gt;//display the returned image&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;picView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setImageBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

              &lt;span class=&quot;c1&quot;&gt;//start intent to draw lines&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Draw_lines&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;putExtra&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXTRA_MESSAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
              &lt;span class=&quot;n&quot;&gt;startActivityForResult&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APP_REQUEST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;requestCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;APP_REQUEST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extras&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getExtras&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extras&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXTRA_MESSAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;

      &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image_stream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getContentResolver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BitmapFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;decodeStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image_stream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileNotFoundException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


      &lt;span class=&quot;c1&quot;&gt;//retrieve a reference to the ImageView&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;//display the returned image&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;picView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setImageBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In this block of code, we first check if the resultCode was RESULT_OK, If it was, we check if the requestCode was CAMERA_CAPTURE. If these are both true, we create an InputStream of the picUri and create a bitmap from it. Supposedly, creating it from an InputStream instead of decoding directly saves massively on memory usage, especially with images as big as the ones that will be taken. This block will print the stacktrace in console if it cannot find the file.&lt;/p&gt;

&lt;p&gt;We then get a reference to the imageView and display the image on it.&lt;/p&gt;

&lt;p&gt;After this, we create a new intent for the Draw_lines class, we then hand it the URI in extras with the key EXTRA_MESSAGE. Then, it is started for result with the request code APP_REQUEST. Once the Draw_lines class is finished, it returns the URI as a string, which is then parsed here and displayed on the imageview.&lt;/p&gt;

&lt;h1 id=&quot;draw-lines-class&quot;&gt;Draw Lines class&lt;/h1&gt;

&lt;h2 id=&quot;xml-1&quot;&gt;XML&lt;/h2&gt;

&lt;p&gt;The code for this layout is as follows:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;    &lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;RelativeLayout&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:android=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xmlns:tools=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.android.com/tools&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;match_parent&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ImageView&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/picture&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentLeft=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentRight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentTop=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_above=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/finBtn&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Button&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Finished&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/finBtn&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentBottom=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentRight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentEnd=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_marginRight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;27dp&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_marginEnd=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;27dp&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;EditText&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:inputType=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Name&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:ems=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;10&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentBottom=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentLeft=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_alignParentStart=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_marginLeft=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;15dp&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_marginStart=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;15dp&quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@+id/editText&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/RelativeLayout&amp;gt;&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;main-class-1&quot;&gt;Main Class&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Draw_lines&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OnTouchListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OnClickListener&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;imageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Canvas&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Paint&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textPaint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;downx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;downy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Bitmap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;capture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;viewCoords&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXTRA_MESSAGE&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;&quot;me.sdunbar.intenttest.myKey&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;et&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fixx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fixy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Here, we also implemenet OnTouchListener, this allows us to check for finger presses on the screen instead of just if a button has been pressed, we also declare a number of variables at the start, much like main_activity.&lt;/p&gt;

&lt;h3 id=&quot;oncreate-1&quot;&gt;onCreate()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_draw_lines&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;imageView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ImageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;picture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;et&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;editText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Display&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentDisplay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getWindowManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDefaultDisplay&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dw&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentDisplay&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getWidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dh&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;currentDisplay&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getHeight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getIntent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;capture&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;finBtn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extras&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getExtras&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extras&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXTRA_MESSAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image_stream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getContentResolver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;openInputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BitmapFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;decodeStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image_stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileNotFoundException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getResizedBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dw&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setColor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;BLACK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setStrokeWidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;7.0f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setTextSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;textPaint&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;textPaint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setColor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;WHITE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;textPaint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setStrokeWidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;7.0f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;textPaint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setTextSize&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;imageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setImageBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;imageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnTouchListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;capture&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Since this will be started as an intent, once we've set the content view as usual and declared the imageView, editText, display etc. we begin parsing the Uri passed in. We do this by creating a Bundle called extras and then parsing the string that was stored with the key EXTRA_MESSAGE.&lt;/p&gt;

&lt;p&gt;With this key, we create an inputstream again to create the bitmap which we have named thePic. We then call the getResizedBitmap() method which will be explained below.&lt;/p&gt;

&lt;p&gt;Then we create the canvas and call setBitmap(thePic), this allows us to draw on and modify it.&lt;/p&gt;

&lt;p&gt;We then create two Paint() objects, one for the line and the other for text.&lt;/p&gt;

&lt;p&gt;Finally we set the imageView to thePic, so as to see the image we are drawing on. Then we set the onClickListener and onTouchListener as required.&lt;/p&gt;

&lt;h3 id=&quot;getresizedbitmap&quot;&gt;getResizedBitmap()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bitmap&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getResizedBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bitmap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxHeight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scale&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxHeight&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getWidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxWidth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getHeight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()));&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Matrix&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Matrix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;postScale&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Bitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;createBitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getWidth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getHeight&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is the code used to scale the bitmap, which was created by user &quot;Kevin&quot; at &lt;a href=&quot;http://stackoverflow.com/questions/4837715/how-to-resize-a-bitmap-in-android&quot;&gt;http://stackoverflow.com/questions/4837715/how-to-resize-a-bitmap-in-android&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I then modified his code somewhat, to pass in my own dimensions. It takes in a bitmap and a max height and width. It then creates a float representing the aspect ratio of the image, creating a Matrix object based on this, it then returns a new bitmap with this scaling applied.&lt;/p&gt;

&lt;h3 id=&quot;ontouch&quot;&gt;onTouch()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onTouch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MotionEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAction&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MotionEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACTION_DOWN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;downx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;downy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MotionEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACTION_MOVE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MotionEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACTION_UP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;upx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;upy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;drawLine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;downx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;downy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;fillArrow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;downx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;downy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;downx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;texty&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;downy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;drawText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;et&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;texty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textPaint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;imageView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;invalidate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MotionEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACTION_CANCEL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This code handles when we touch the imageview, when the finger is pressed down, we get the coordinates, when the finger is released we grab the coordinates for that also.&lt;/p&gt;

&lt;p&gt;With these coordinates, we draw a line, and then call fillArrow() to add arrowheads to the ends of the line.&lt;/p&gt;

&lt;p&gt;We then average the X and Y coordinates of the start and end. We call drawText with the text from the editText, along with the coordinates and the textPaint object. We then invalidate the imageView to refresh it.&lt;/p&gt;

&lt;h3 id=&quot;onclick-1&quot;&gt;onClick()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;finBtn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Here, thisActivity is the current activity&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;FileOutputStream&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getExternalStorageDirectory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getExternalStoragePublicDirectory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DIRECTORY_PICTURES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;CameraDemo&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SimpleDateFormat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;yyyyMMdd_HHmmss&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;imageFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeStamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mediaStorageDir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;separator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;imageFileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;_lines.png&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

                &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;thePic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;compress&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bitmap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;CompressFormat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;PNG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// bmp is your Bitmap instance&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// PNG is a lossless format, the compression factor (100) is ignored&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toURI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;putExtra&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EXTRA_MESSAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;picUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;setResult&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RESULT_OK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;finish&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This code handles the button press. First we create a FileOutputStream, then similarly to main_acitivity, we determine the public pictures directory and use our own folder CameraDemo.&lt;/p&gt;

&lt;p&gt;We then create a time stamp to use as the image name, exactly as we did in main_activity, however, this time instead of appending .png, we append lines.png, to differentiate the two images.&lt;/p&gt;

&lt;p&gt;We then &quot;compress&quot; the image and write it out to the file, since we are using png, it is not actually compressed and the quality factor of 100 has no impact.&lt;/p&gt;

&lt;p&gt;Finally, we create an intent object, parse the Uri from file and store the string representation of this with the key EXTRA_MESSAGE. We then setResult of RESULT_OK and finish().&lt;/p&gt;

&lt;h3 id=&quot;fillarrow&quot;&gt;fillArrow()&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fillArrow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Canvas&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setStyle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Style&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;FILL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_x_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_x_2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_x_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x_4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y_4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_x_4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_x_5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x_6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y_6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;frac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_x_6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x_6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y_6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setFillType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;FillType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;EVEN_ODD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setFillType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;FillType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;EVEN_ODD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;moveTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_x_1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lineTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_x_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lineTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_x_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;moveTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_x_6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_y_6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lineTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_x_5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_y_5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lineTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;point_x_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point_y_4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

      &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;drawPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;canvas&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;drawPath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;paint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is the code for fillArrow() which I have gotten from Pierre. It uses the start and end coordinates of the line to draw 2 arrowheads on both ends. Unfortunately, I am not familiar enough with the math involved to explain further how this works.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;This formal element was intended to give us the skills required to design an Android application that could open a camera, save the image and then draw lines on said image with dimensions. Through this report I believe I have adequately demonstrated how to construct such an application.&lt;/p&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><summary type="html">This is the complete report I submitted for my Mobile Applications module in DT080B</summary></entry><entry><title type="html">Migrating From Google Authenticator To Authy</title><link href="https://sdunbar.me/guides/Migrating-from-Google-Authenticator-to-Authy/" rel="alternate" type="text/html" title="Migrating From Google Authenticator To Authy" /><published>2016-11-26T00:00:00+00:00</published><updated>2016-11-26T00:00:00+00:00</updated><id>https://sdunbar.me/guides/Migrating-from-Google-Authenticator-to-Authy</id><content type="html" xml:base="https://sdunbar.me/guides/Migrating-from-Google-Authenticator-to-Authy/">&lt;h2 id=&quot;migrating-from-google-authenticator-to-authy&quot;&gt;Migrating from Google Authenticator to Authy&lt;/h2&gt;

&lt;p&gt;Two Factor Authentication is a neccessity these days and I try to use it wherever I can, but I was concerned still over what happened if I lost my phone and thus access to my 2FA credentials. To get around this using Google Authenticator I used Titanium Backup to backup the APK and data every 24 hours, but this was really clunky and I didn’t like that there was no built-in method to backup this data.&lt;/p&gt;

&lt;p&gt;Then I discovered Authy, which promises features such as account backups and multi-device usage, such as using a Chrome App to access your 2FA codes when needed. I decided to give it a shot but first I had to copy over my old data from Google Auth.&lt;/p&gt;

&lt;h3 id=&quot;exporting-google-authenticator-account-info&quot;&gt;Exporting Google Authenticator account info&lt;/h3&gt;
&lt;p&gt;I found that Google Authenticator did not have a simple way to get code information back out, but after some online searching I found &lt;a href=&quot;https://jcode.me/migrate-from-google-authenticator-to-authy-android-5/&quot;&gt;a post on jcode.me detailing the process&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For this, you need to use ADB and have ADB drivers installed for your phone.&lt;/p&gt;

&lt;p&gt;With the phone connected:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;adb shell
su
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;On my phone, I then had to copy over an sqlite3 binary, &lt;a href=&quot;http://forum.xda-developers.com/showpost.php?p=57143465&amp;amp;postcount=15&quot;&gt;found here through XDA&lt;/a&gt;, to my Download folder.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mount -o remount,rw /system 
cp /sdcard/Download/sqlite3 /system/xbin
chmod +x /system/xbin/sqlite3
mount -o remount,ro /system 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now we can finally access the database:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sqlite3 /data/data/com.google.android.apps.authenticator2/databases/databases
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In the database, we select all information from the accounts table:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;select * from accounts;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This will spit out a number of account details, we are only concerned with the 3rd field, which is the code used we will use to add the key to Authy.&lt;/p&gt;

&lt;p&gt;This can be typed in manually, or you can generate a QR code of the following URL to scan in Authy, where XXXX in the example represents the name of the account being added and XXXX represents the code:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;otpauth://totp/XXXX?secret=YYYY
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;With all these steps completed, I then scanned in the QR codes I generated, which prompted me to identify the account associated with the code and in some cases, tweak the service it was for. Unfortunately, not all services had an icon for them, so they are forced to use a generic icon.&lt;/p&gt;</content><author><name>Sean Dunbar</name><email>sean@sdunbar.me</email></author><category term="Personal" /><summary type="html">I decided to move from Google Authenticator to Authy, so I could have more devices and a backup if I lost my phone</summary></entry></feed>